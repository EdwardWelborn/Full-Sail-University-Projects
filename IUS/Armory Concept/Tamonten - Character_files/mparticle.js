//
//  Copyright 2017 mParticle, Inc.
//
//  Licensed under the Apache License, Version 2.0 (the "License");
//  you may not use this file except in compliance with the License.
//  You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
//  Unless required by applicable law or agreed to in writing, software
//  distributed under the License is distributed on an "AS IS" BASIS,
//  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//  See the License for the specific language governing permissions and
//  limitations under the License.
//
//  Uses portions of code from jQuery
//  jQuery v1.10.2 | (c) 2005, 2013 jQuery Foundation, Inc. | jquery.org/license

window.mParticle = window.mParticle || {};;
window.mParticle.config = window.mParticle.config || {};;
window.mParticle.config.serviceUrl = 'jssdk.mparticle.com/v2/JS/';;
window.mParticle.config.secureServiceUrl = 'jssdks.mparticle.com/v2/JS/';;
window.mParticle.config.appName = "World of Warcraft";;
window.mParticle.config.minWebviewBridgeVersion = 1;
window.mParticle.config.workspaceToken = "BDCBEA5A";;
window.mParticle.config.aliasMaxWindow = 90;
window.mParticle.config.kitConfigs = window.mParticle.config.kitConfigs || [];;
window.mParticle.config.pixelConfigs = window.mParticle.config.pixelConfigs || [];;
window.mParticle.config.flags = {};
var mParticle=function(){function re(){return mParticle.Store.isEnabled&&(mParticle.Store.devToken||mParticle.Store.webviewBridgeEnabled)?!0:!1}function ue(n){return n==="false"||n==="0"?!1:Boolean(n)}function fe(n){if(mParticle.preInit.featureFlags)return mParticle.preInit.featureFlags[n]}function ee(n,t,i,r,u){n||mParticle.Logger.warning("There is no callback provided");try{ht.isFunction(n)&&n({httpCode:t,body:i,getUser:function(){return r?r:mParticle.Identity.getCurrentUser()},getPreviousUser:function(){if(u)return mParticle.Identity.getUser(u);var t=mParticle.Identity.getUsers(),n=t.shift(),i=r||mParticle.Identity.getCurrentUser();return n&&i&&n.getMPID()===i.getMPID()&&(n=t.shift()),n||null}})}catch(f){mParticle.Logger.error("There was an error with your callback: "+f)}}function oe(n,t,i){n||mParticle.Logger.warning("There is no callback provided");try{if(ht.isFunction(n)){var r={httpCode:t};i&&(r.message=i);n(r)}}catch(u){mParticle.Logger.error("There was an error with your callback: "+u)}}function dr(){var e,f,r,i,o,s,t=arguments[0]||{},u=1,c=arguments.length,h=!1,n={hasOwn:Object.prototype.hasOwnProperty,class2type:{},type:function(t){return t==null?String(t):n.class2type[Object.prototype.toString.call(t)]||"object"},isPlainObject:function(t){if(!t||n.type(t)!=="object"||t.nodeType||n.isWindow(t))return!1;try{if(t.constructor&&!n.hasOwn.call(t,"constructor")&&!n.hasOwn.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}for(var i in t);return i===undefined||n.hasOwn.call(t,i)},isArray:Array.isArray||function(t){return n.type(t)==="array"},isFunction:function(t){return n.type(t)==="function"},isWindow:function(n){return n!=null&&n==n.window}};for(typeof t=="boolean"&&(h=t,t=arguments[1]||{},u=2),typeof t=="object"||n.isFunction(t)||(t={}),c===u&&(t=this,--u);u<c;u++)if((e=arguments[u])!=null)for(f in e)(r=t[f],i=e[f],t!==i)&&(h&&i&&(n.isPlainObject(i)||(o=n.isArray(i)))?(o?(o=!1,s=r&&n.isArray(r)?r:[]):s=r&&n.isPlainObject(r)?r:{},t[f]=dr(h,s,i)):i!==undefined&&(t[f]=i));return t}function it(n){var t=Object.prototype.toString.call(n);return t==="[object Object]"||t==="[object Error]"}function ci(n,t){var i=0,r;if(Array.prototype.indexOf)return n.indexOf(t,0)>=0;for(r=n.length;i<r;i++)if(i in n&&n[i]===t)return!0}function se(n,t){var r=window.mParticle&&mParticle.Store.SDKConfig.forceHttps?"https://":window.location.protocol+"//",i;return i=mParticle.Store.SDKConfig.forceHttps?"https://"+n:r+n,t&&(i=i+t),i}function he(n){var t;try{t=new window.XMLHttpRequest}catch(i){mParticle.Logger.error("Error creating XMLHttpRequest object.")}if(t&&n&&"withCredentials"in t)t.onreadystatechange=n;else if(typeof XDomainRequest!="undefined"){mParticle.Logger.verbose("Creating XDomainRequest object");try{t=new window.XDomainRequest;t.onload=n}catch(i){mParticle.Logger.error("Error creating XDomainRequest object")}}return t}function ce(n){var t;return(window.crypto&&window.crypto.getRandomValues&&(t=window.crypto.getRandomValues(new Uint8Array(1))),t)?(n^t[0]%16>>n/4).toString(16):(n^Math.random()*16>>n/4).toString(16)}function gr(n){return n?ce(n):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,gr)}function le(n,i){var f=[],r,u,e;if(n&&Object.keys(n).length)for(r in n)n.hasOwnProperty(r)&&(u=t.IdentityType.getIdentityType(r),ci(i,u)||(e={Type:u,Identity:n[r]},u===mParticle.IdentityType.CustomerId?f.unshift(e):f.push(e)));return f}function ae(n,i){var u={},r,f;if(n&&Object.keys(n).length)for(r in n)n.hasOwnProperty(r)&&(f=t.IdentityType.getIdentityType(r),ci(i,f)||(u[r]=n[r]));return u}function ve(n,t){var r={},i,u;if(n&&Object.keys(n).length)for(i in n)n.hasOwnProperty(i)&&(u=nu(i),ci(t,u)||(r[i]=n[i]));return r}function ye(n,t){if(t&&n)for(var i in n)if(n.hasOwnProperty(i)&&i.toLowerCase()===t.toLowerCase())return i;return null}function pe(n){return decodeURIComponent(n.replace(ie," "))}function we(n){return n.indexOf('"')===0&&(n=n.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")),n}function be(n){for(var i in t.EventType)if(t.EventType.hasOwnProperty(i)&&t.EventType[i]===n)return!0;return!1}function ke(n){if(isNaN(n)||!isFinite(n))return 0;var t=parseFloat(n);return isNaN(t)?0:t}function de(n){return ht.isStringOrNumber(n)?n:null}function nu(n){var t=0,i=0,r;if(n===undefined||n===null)return 0;if(n=n.toString().toLowerCase(),Array.prototype.reduce)return n.split("").reduce(function(n,t){return n=(n<<5)-n+t.charCodeAt(0),n&n},0);if(n.length===0)return t;for(i=0;i<n.length;i++)r=n.charCodeAt(i),t=(t<<5)-t+r,t=t&t;return t}function ge(n){var i,t;if(!n||!it(n))return null;i={};for(t in n)n.hasOwnProperty(t)&&ht.isValidAttributeValue(n[t])?i[t]=n[t]:mParticle.Logger.warning("The corresponding attribute value of "+t+" must be a string, number, boolean, or null.");return i}function no(n,t,i){if(i-t>mParticle.Store.SDKConfig.integrationDelayTimeout)return!1;for(var r in n){if(n[r]===!0)return!0;continue}return!1}function to(n,t,i,r,u,f){if(n.length&&t&&i){var e=n;mParticle.Store.eventQueue=[];e.forEach(function(n){n.MPID=t;r(n,u,f)})}}function io(n){return n?hi.currentStorageName+"_"+n:hi.currentStorageName}function ro(n){return n?hi.currentStorageProductsName+"_"+n:hi.currentStorageProductsName}function iu(n){if(!n)return!1;var i=tu+"_"+n+"_v2",t=nr+"_"+n+"_v2";return window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.hasOwnProperty(t)?!0:window.mParticle.uiwebviewBridgeName===t?!0:window.hasOwnProperty(i)?!0:!1}function uo(n,t){return(mParticle.Store.bridgeV2Available=iu(n),mParticle.Store.bridgeV1Available=fo(),t===2)?mParticle.Store.bridgeV2Available:window.mParticle.uiwebviewBridgeName&&window.mParticle.uiwebviewBridgeName!==nr+"_"+n+"_v2"?!1:t<2?mParticle.Store.bridgeV2Available||mParticle.Store.bridgeV1Available:!1}function fo(){return mParticle.Store.SDKConfig.useNativeSdk||window.mParticleAndroid||mParticle.Store.SDKConfig.isIOS?!0:!1}function eo(n,t){if(mParticle.Store.bridgeV2Available&&mParticle.Store.SDKConfig.minWebviewBridgeVersion===2){uu(n,t,mParticle.Store.SDKConfig.requiredWebviewBridgeName);return}if(mParticle.Store.bridgeV2Available&&mParticle.Store.SDKConfig.minWebviewBridgeVersion<2){uu(n,t,mParticle.Store.SDKConfig.requiredWebviewBridgeName);return}if(mParticle.Store.bridgeV1Available&&mParticle.Store.SDKConfig.minWebviewBridgeVersion<2){oo(n,t);return}}function oo(n,t){window.mParticleAndroid&&window.mParticleAndroid.hasOwnProperty(n)?(mParticle.Logger.verbose(ti.InformationMessages.SendAndroid+n),window.mParticleAndroid[n](t)):mParticle.Store.SDKConfig.isIOS&&(mParticle.Logger.verbose(ti.InformationMessages.SendIOS+n),ru(n,t))}function ru(n,t){var i=document.createElement("IFRAME");i.setAttribute("src","mp-sdk://"+n+"/"+encodeURIComponent(t));document.documentElement.appendChild(i);i.parentNode.removeChild(i);i=null}function uu(n,t,i){if(i){var o=tu+"_"+i+"_v2",u=window[o],r=nr+"_"+i+"_v2",f,e;if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers[r]&&(f=window.webkit.messageHandlers[r]),window.mParticle.uiwebviewBridgeName===r&&(e=window.mParticle[r]),u&&u.hasOwnProperty(n)){mParticle.Logger.verbose(ti.InformationMessages.SendAndroid+n);u[n](t);return}f?(mParticle.Logger.verbose(ti.InformationMessages.SendIOS+n),f.postMessage(JSON.stringify({path:n,value:t?JSON.parse(t):null}))):e&&(mParticle.Logger.verbose(ti.InformationMessages.SendIOS+n),ru(n,t))}}function tr(n,t,i,r,u){return typeof n!="boolean"?(mParticle.Logger.error("Consented boolean is required when constructing a GDPR Consent object."),null):t&&isNaN(t)?(mParticle.Logger.error("Timestamp must be a valid number when constructing a GDPR Consent object."),null):i&&typeof i!="string"?(mParticle.Logger.error("Document must be a valid string when constructing a GDPR Consent object."),null):r&&typeof r!="string"?(mParticle.Logger.error("Location must be a valid string when constructing a GDPR Consent object."),null):u&&typeof u!="string"?(mParticle.Logger.error("Hardware ID must be a valid string when constructing a GDPR Consent object."),null):{Consented:n,Timestamp:t||Date.now(),ConsentDocument:i,Location:r,HardwareId:u}}function eu(t){function r(n){if(typeof n!="string")return null;var t=n.trim();return t.length?t.toLowerCase():null}function u(t){if(t){if(n.isObject(t)){i={};for(var r in t)t.hasOwnProperty(r)&&f(r,t[r])}}else i={};return this}function f(t,u){var e=r(t),f;return e?n.isObject(u)?(f=tr(u.Consented,u.Timestamp,u.ConsentDocument,u.Location,u.HardwareId),f&&(i[e]=f),this):(mParticle.Logger.error("addGDPRConsentState() invoked with bad or empty GDPR consent object."),this):(mParticle.Logger.error("addGDPRConsentState() invoked with bad purpose. Purpose must be a string."),this)}function e(n){var t=r(n);return t?(delete i[t],this):this}function o(){return n.extend({},i)}var i={};return t&&u(t.getGDPRConsentState()),{setGDPRConsentState:u,addGDPRConsentState:f,getGDPRConsentState:o,removeGDPRConsentState:e}}function ou(){return!mParticle.Store.SDKConfig.useCookieStorage&&mParticle.Store.isLocalStorageAvailable}function so(){var e,i,t,r,f,o,u;try{i=ui();t=fi();i||t?mParticle.Store.isFirstRun=!1:(mParticle.Store.isFirstRun=!0,mParticle.Store.mpid=0);mParticle.Store.isLocalStorageAvailable||(mParticle.Store.SDKConfig.useCookieStorage=!0);mParticle.Store.isLocalStorageAvailable?(e=window.localStorage,mParticle.Store.SDKConfig.useCookieStorage?(i?(r=t?n.extend(!1,i,t):i,e.removeItem(mParticle.Store.storageName)):t&&(r=t),pt(r)):t?(r=i?n.extend(!1,i,t):t,pt(r),ut(mParticle.Store.storageName)):pt(i)):pt(t);try{mParticle.Store.isLocalStorageAvailable&&(f=localStorage.getItem(mParticle.Store.prodStorageName),f&&(o=JSON.parse(k.decode(f))),mParticle.Store.mpid&&ho(o,mParticle.Store.mpid))}catch(s){mParticle.Store.isLocalStorageAvailable&&localStorage.removeItem(mParticle.Store.prodStorageName);mParticle.Store.cartProducts=[];mParticle.Logger.error("Error loading products in initialization: "+s)}for(u in r)r.hasOwnProperty(u)&&(ri[u]||(mParticle.Store.nonCurrentUserMPIDs[u]=r[u]));su()}catch(s){ou()&&mParticle.Store.isLocalStorageAvailable?localStorage.removeItem(mParticle.Store.storageName):ut(mParticle.Store.storageName);mParticle.Logger.error("Error initializing storage: "+s)}}function su(){mParticle.Store.webviewBridgeEnabled||(mParticle.Store.SDKConfig.useCookieStorage&&vu(),cu())}function ho(n,t){if(n)try{mParticle.Store.cartProducts=n[t]&&n[t].cp?n[t].cp:[]}catch(i){mParticle.Logger.error(yt.ErrorMessages.CookieParseError)}}function pt(t,i){try{t?(mParticle.Store.mpid=i?i:t.cu||0,t.gs=t.gs||{},mParticle.Store.sessionId=t.gs.sid||mParticle.Store.sessionId,mParticle.Store.isEnabled=typeof t.gs.ie!="undefined"?t.gs.ie:mParticle.Store.isEnabled,mParticle.Store.sessionAttributes=t.gs.sa||mParticle.Store.sessionAttributes,mParticle.Store.serverSettings=t.gs.ss||mParticle.Store.serverSettings,mParticle.Store.devToken=mParticle.Store.devToken||t.gs.dt,mParticle.Store.SDKConfig.appVersion=mParticle.Store.SDKConfig.appVersion||t.gs.av,mParticle.Store.clientId=t.gs.cgid||mParticle.Store.clientId||n.generateUniqueId(),mParticle.Store.deviceId=t.gs.das||mParticle.Store.deviceId||n.generateUniqueId(),mParticle.Store.integrationAttributes=t.gs.ia||{},mParticle.Store.context=t.gs.c||mParticle.Store.context,mParticle.Store.currentSessionMPIDs=t.gs.csm||mParticle.Store.currentSessionMPIDs,mParticle.Store.isLoggedIn=t.l===!0,t.gs.les&&(mParticle.Store.dateLastEventSent=new Date(t.gs.les)),mParticle.Store.sessionStartDate=t.gs.ssd?new Date(t.gs.ssd):new Date,t=i?t[i]:t[t.cu]):(mParticle.Logger.verbose(yt.InformationMessages.CookieNotFound),mParticle.Store.clientId=mParticle.Store.clientId||n.generateUniqueId(),mParticle.Store.deviceId=mParticle.Store.deviceId||n.generateUniqueId())}catch(r){mParticle.Logger.error(yt.ErrorMessages.CookieParseError)}}function co(n){var t;mParticle._forceNoLocalStorage&&(n=undefined);try{return n.setItem("mparticle","test"),t=n.getItem("mparticle")==="test",n.removeItem("mparticle"),t&&n}catch(i){return!1}}function lo(n){if(!mParticle.Store.isLocalStorageAvailable)return[];var i,t,r=localStorage.getItem(mParticle.Store.prodStorageName);if(r&&(i=k.decode(r)),n)try{return i&&(t=JSON.parse(i)),i&&t[n]&&t[n].cp&&Array.isArray(t[n].cp)?t[n].cp:[]}catch(u){return[]}else return[]}function hu(){var t,i=localStorage.getItem(mParticle.Store.prodStorageName),n;i&&(t=k.decode(i));try{n=JSON.parse(t)}catch(r){n={}}return n}function cu(){if(mParticle.Store.isLocalStorageAvailable){var f=mParticle.Store.storageName,i=hu(),t=ui()||{},u=mParticle.Identity.getCurrentUser(),r=u?u.getMPID():null,e={cp:i[r]?i[r].cp:[]};if(r){i=i||{};i[r]=e;try{window.localStorage.setItem(encodeURIComponent(mParticle.Store.prodStorageName),k.encode(JSON.stringify(i)))}catch(o){mParticle.Logger.error("Error with setting products on localStorage.")}}if(!mParticle.Store.SDKConfig.useCookieStorage){t.gs=t.gs||{};t.l=mParticle.Store.isLoggedIn?1:0;mParticle.Store.sessionId&&(t.gs.csm=mParticle.Store.currentSessionMPIDs);t.gs.ie=mParticle.Store.isEnabled;r&&(t.cu=r);Object.keys(mParticle.Store.nonCurrentUserMPIDs).length&&(t=n.extend({},t,mParticle.Store.nonCurrentUserMPIDs),mParticle.Store.nonCurrentUserMPIDs={});t=lu(t);try{window.localStorage.setItem(encodeURIComponent(f),ur(JSON.stringify(t)))}catch(o){mParticle.Logger.error("Error with setting localStorage item.")}}}}function lu(n){var t=mParticle.Store;return n.gs.sid=t.sessionId,n.gs.ie=t.isEnabled,n.gs.sa=t.sessionAttributes,n.gs.ss=t.serverSettings,n.gs.dt=t.devToken,n.gs.les=t.dateLastEventSent?t.dateLastEventSent.getTime():null,n.gs.av=t.SDKConfig.appVersion,n.gs.cgid=t.clientId,n.gs.das=t.deviceId,n.gs.c=t.context,n.gs.ssd=t.sessionStartDate?t.sessionStartDate.getTime():null,n.gs.ia=t.integrationAttributes,n}function ui(){if(!mParticle.Store.isLocalStorageAvailable)return null;var r=mParticle.Store.storageName,n=fr(window.localStorage.getItem(r)),i={},t;if(n){n=JSON.parse(n);for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t])}return Object.keys(i).length?i:null}function ct(n){localStorage.removeItem(n)}function ao(){return mParticle.Store.deviceId?mParticle.Store.deviceId:au(mParticle.Store.serverSettings)}function au(t){try{var i={},r;return t&&t.uid&&t.uid.Value&&(t.uid.Value.split("&").forEach(function(n){r=n.split("=");i[r[0]]=r[1]}),i.g)?i.g:n.generateUniqueId()}catch(u){return n.generateUniqueId()}}function ut(n){var t=new Date,r,u,i;i=ai();u=i===""?"":";domain="+i;t.setTime(t.getTime()-864e5);r="; expires="+t.toUTCString();document.cookie=n+"="+r+"; path=/"+u}function fi(){var o=window.document.cookie.split("; "),t=mParticle.Store.storageName,i,s,u,f,e,r=t?undefined:{};for(mParticle.Logger.verbose(yt.InformationMessages.CookieSearch),i=0,s=o.length;i<s;i++){if(u=o[i].split("="),f=n.decoded(u.shift()),e=n.decoded(u.join("=")),t&&t===f){r=n.converted(e);break}t||(r[f]=n.converted(e))}return r?(mParticle.Logger.verbose(yt.InformationMessages.CookieFound),JSON.parse(fr(r))):null}function vu(){var i,u=mParticle.Identity.getCurrentUser();u&&(i=u.getMPID());var o=new Date,s=mParticle.Store.storageName,t=fi()||{},h=new Date(o.getTime()+mParticle.Store.SDKConfig.cookieExpiration*864e5).toGMTString(),r,f,e;r=ai();f=r===""?"":";domain="+r;t.gs=t.gs||{};mParticle.Store.sessionId&&(t.gs.csm=mParticle.Store.currentSessionMPIDs);i&&(t.cu=i);t.l=mParticle.Store.isLoggedIn?1:0;t=lu(t);Object.keys(mParticle.Store.nonCurrentUserMPIDs).length&&(t=n.extend({},t,mParticle.Store.nonCurrentUserMPIDs),mParticle.Store.nonCurrentUserMPIDs={});e=ir(t,h,f,mParticle.Store.SDKConfig.maxCookieSize);mParticle.Logger.verbose(yt.InformationMessages.CookieSet);window.document.cookie=encodeURIComponent(s)+"="+e}function ir(n,t,i,r){var u,s=n.gs.csm?n.gs.csm:[],f,e,o,h,c,l;if(s.length){e={};for(o in n)n.hasOwnProperty(o)&&(ri[o]||o===n.cu||(e[o]=1));if(Object.keys(e).length)for(h in e)u=rr(n,t,i),u.length>r&&e.hasOwnProperty(h)&&s.indexOf(h)===-1&&delete n[h];for(c=0;c<s.length;c++)if(u=rr(n,t,i),u.length>r)l=s[c],n[l]?(mParticle.Logger.verbose("Size of new encoded cookie is larger than maxCookieSize setting of "+r+". Removing from cookie the earliest logged in MPID containing: "+JSON.stringify(n[l],0,2)),delete n[l]):mParticle.Logger.error("Unable to save MPID data to cookies because the resulting encoded cookie is larger than the maxCookieSize setting of "+r+". We recommend using a maxCookieSize of 1500.");else break}else for(f in n)n.hasOwnProperty(f)&&(u=rr(n,t,i),u.length>r&&(ri[f]||f===n.cu||delete n[f]));return u}function rr(n,t,i){return ur(JSON.stringify(n))+";expires="+t+";path=/"+i}function vo(n){var t=fi()||ui(),r,u,i,f,e;if(n)for(u in n.userIdentities)if(t&&Object.keys(t).length)for(i in t)if(t[i].mpid){f=t[i].ui;for(e in f)if(u===e&&n.userIdentities[u]===f[e]){r=i;break}}r&&pt(t,r)}function ur(t){var i,r;t=JSON.parse(t);for(i in t.gs)t.gs.hasOwnProperty(i)&&(li[i]?t.gs[i]?Array.isArray(t.gs[i])&&t.gs[i].length?t.gs[i]=k.encode(JSON.stringify(t.gs[i])):n.isObject(t.gs[i])&&Object.keys(t.gs[i]).length?t.gs[i]=k.encode(JSON.stringify(t.gs[i])):delete t.gs[i]:delete t.gs[i]:i==="ie"?t.gs[i]=t.gs[i]?1:0:t.gs[i]||delete t.gs[i]);for(r in t)if(t.hasOwnProperty(r)&&!ri[r])for(i in t[r])t[r].hasOwnProperty(i)&&li[i]&&(n.isObject(t[r][i])&&Object.keys(t[r][i]).length?t[r][i]=k.encode(JSON.stringify(t[r][i])):delete t[r][i]);return ku(JSON.stringify(t))}function fr(t){var i,r;try{if(t){if(t=JSON.parse(du(t)),n.isObject(t)&&Object.keys(t).length){for(i in t.gs)t.gs.hasOwnProperty(i)&&(li[i]?t.gs[i]=JSON.parse(k.decode(t.gs[i])):i==="ie"&&(t.gs[i]=Boolean(t.gs[i])));for(r in t)if(t.hasOwnProperty(r))if(ri[r])r==="l"&&(t[r]=Boolean(t[r]));else for(i in t[r])t[r].hasOwnProperty(i)&&li[i]&&t[r][i].length&&(t[r][i]=JSON.parse(k.decode(t[r][i])))}return JSON.stringify(t)}}catch(u){mParticle.Logger.error("Problem with decoding cookie",u)}}function yu(n){return n.replace(/,/g,"|")}function pu(n){return n.replace(/\|/g,",")}function wu(n){return n.replace(/\'/g,'"')}function bu(n){return n.replace(/\"/g,"'")}function ku(n){return yu(bu(n))}function du(n){return pu(wu(n))}function ai(){if(mParticle.Store.SDKConfig.cookieDomain)return mParticle.Store.SDKConfig.cookieDomain;var n=yo(document,location.hostname);return n===""?"":"."+n}function yo(n,t){for(var r,u="mptest=cookie",f=t.split("."),i=f.length-1;i>=0;i--)if(r=f.slice(i).join("."),n.cookie=u+";domain=."+r+";",n.cookie.indexOf(u)>-1)return n.cookie=u.split("=")[0]+"=;domain=."+r+";expires=Thu, 01 Jan 1970 00:00:01 GMT;",r;return""}function po(n){var t=b();return t&&t[n]&&t[n].ui?t[n].ui:{}}function wo(n){var t=b();return t&&t[n]&&t[n].ua?t[n].ua:{}}function bo(n){var t,i=localStorage.getItem(mParticle.Store.prodStorageName);return i&&(t=JSON.parse(k.decode(i)),t&&t[n]&&t[n].cp)?t[n].cp:[]}function ko(n){if(mParticle.Store.isLocalStorageAvailable)try{window.localStorage.setItem(encodeURIComponent(mParticle.Store.prodStorageName),k.encode(JSON.stringify(n)))}catch(t){mParticle.Logger.error("Error with setting products on localStorage.")}}function go(n,t){if(t){var i=b();i&&(i[n]?i[n].ui=t:i[n]={ui:t},lt(i))}}function ns(n,t){var i=b();t&&(i&&(i[n]?i[n].ui=t:i[n]={ui:t}),lt(i))}function ts(n,t){if(t){var i=b();i&&(i[n]?i[n].csd=t:i[n]={csd:t});lt(i)}}function is(n,t){if(t||t===null){var i=b();i&&(i[n]?i[n].con=ii.Serialization.toMinifiedJsonObject(t):i[n]={con:ii.Serialization.toMinifiedJsonObject(t)},lt(i))}}function lt(n){var u=ur(JSON.stringify(n)),f=new Date,e=mParticle.Store.storageName,o=new Date(f.getTime()+mParticle.Store.SDKConfig.cookieExpiration*864e5).toGMTString(),t=ai(),i,r;i=t===""?"":";domain="+t;mParticle.Store.SDKConfig.useCookieStorage?(r=ir(n,o,i,mParticle.Store.SDKConfig.maxCookieSize),window.document.cookie=encodeURIComponent(e)+"="+r):mParticle.Store.isLocalStorageAvailable&&localStorage.setItem(mParticle.Store.storageName,u)}function b(){return mParticle.Store.SDKConfig.useCookieStorage?fi():ui()}function rs(n){var t=b();return t&&t[n]&&t[n].con?ii.Serialization.fromMinifiedJsonObject(t[n].con):null}function us(n){if(!n)return null;var t=b();return t&&t[n]&&t[n].fst?t[n].fst:null}function fs(n,t){if(n){t||(t=(new Date).getTime());var i=b();i&&(i[n]||(i[n]={}),i[n].fst||(i[n].fst=t,lt(i)))}}function es(n){if(!n)return null;if(n===mParticle.Identity.getCurrentUser().getMPID())return(new Date).getTime();var t=b();return t&&t[n]&&t[n].lst?t[n].lst:null}function os(n,t){if(n){t||(t=(new Date).getTime());var i=b();i&&i[n]&&(i[n].lst=t,lt(i))}}function ss(){return mParticle.Store.deviceId}function hs(){if(ct(rt.localStorageName),ct(rt.localStorageNameV3),ct(rt.localStorageNameV4),ct(mParticle.Store.prodStorageName),ct(rt.localStorageProductsV4),ut(rt.cookieName),ut(rt.cookieNameV2),ut(rt.cookieNameV3),ut(rt.cookieNameV4),mParticle._isTestEnv){var t="abcdef";ct(n.createMainStorageName(t));ut(n.createMainStorageName(t));ct(n.createProductStorageName(t))}}function er(n,t,i,u){var f=document.createElement("img");mParticle.Logger.verbose(cs.InformationMessages.CookieSync);f.src=n;u[t.toString()]=(new Date).getTime();r.saveUserCookieSyncDatesToCookies(i,u)}function as(n,t){var r=[],i;t.flags={};for(i in n.CustomFlags)r=[],n.CustomFlags.hasOwnProperty(i)&&(Array.isArray(n.CustomFlags[i])?n.CustomFlags[i].forEach(function(n){(typeof n=="number"||typeof n=="string"||typeof n=="boolean")&&r.push(n.toString())}):(typeof n.CustomFlags[i]=="number"||typeof n.CustomFlags[i]=="string"||typeof n.CustomFlags[i]=="boolean")&&r.push(n.CustomFlags[i].toString()),r.length&&(t.flags[i]=r))}function sr(n){return n?n.map(function(n){return vs(n)}):[]}function vs(t){return{id:n.parseStringOrNumber(t.Sku),nm:n.parseStringOrNumber(t.Name),pr:ft(t.Price),qt:ft(t.Quantity),br:n.parseStringOrNumber(t.Brand),va:n.parseStringOrNumber(t.Variant),ca:n.parseStringOrNumber(t.Category),ps:ft(t.Position),cc:n.parseStringOrNumber(t.CouponCode),tpa:ft(t.TotalAmount),attrs:t.Attributes}}function gu(n){var f,u,r,i,t;if(!n)return null;if(f={},u=n.getGDPRConsentState(),u){r={};f.gdpr=r;for(i in u)u.hasOwnProperty(i)&&(t=u[i],f.gdpr[i]={},typeof t.Consented=="boolean"&&(r[i].c=t.Consented),typeof t.Timestamp=="number"&&(r[i].ts=t.Timestamp),typeof t.ConsentDocument=="string"&&(r[i].d=t.ConsentDocument),typeof t.Location=="string"&&(r[i].l=t.Location),typeof t.HardwareId=="string"&&(r[i].h=t.HardwareId))}return f}function ys(i,r,f,e,o){var h,l={},s=mParticle.Identity.getCurrentUser(),a=s?s.getUserIdentities().userIdentities:{},v=i===t.MessageType.OptOut?!mParticle.Store.isEnabled:null,c;if(f=n.sanitizeAttributes(f),mParticle.Store.sessionId||i==t.MessageType.OptOut||mParticle.Store.webviewBridgeEnabled){for(c in a)l[t.IdentityType.getIdentityType(c)]=a[c];return i!==t.MessageType.SessionEnd&&(mParticle.Store.dateLastEventSent=new Date),h={EventName:r||i,EventCategory:e,UserAttributes:s?s.getAllUserAttributes():{},UserIdentities:l,Store:mParticle.Store.serverSettings,EventAttributes:f,SDKVersion:u.sdkVersion,SessionId:mParticle.Store.sessionId,SessionStartDate:mParticle.Store.sessionStartDate?mParticle.Store.sessionStartDate.getTime():null,EventDataType:i,Debug:mParticle.Store.SDKConfig.isDevelopmentMode,Location:mParticle.Store.currentPosition,OptOut:v,ExpandedEventCount:0,CustomFlags:o,AppVersion:mParticle.Store.SDKConfig.appVersion,ClientGeneratedId:mParticle.Store.clientId,DeviceId:mParticle.Store.deviceId,MPID:s?s.getMPID():null,ConsentState:s?s.getConsentState():null,IntegrationAttributes:mParticle.Store.integrationAttributes},i===t.MessageType.SessionEnd&&(h.SessionLength=mParticle.Store.dateLastEventSent.getTime()-mParticle.Store.sessionStartDate.getTime(),h.currentSessionMPIDs=mParticle.Store.currentSessionMPIDs,h.EventAttributes=mParticle.Store.sessionAttributes,mParticle.Store.currentSessionMPIDs=[],mParticle.Store.sessionStartDate=null),h.Timestamp=mParticle.Store.dateLastEventSent.getTime(),h}return null}function ps(n,t,i){var r={n:n.EventName,et:n.EventCategory,ua:n.UserAttributes,ui:n.UserIdentities,ia:n.IntegrationAttributes,str:n.Store,attrs:n.EventAttributes,sdk:n.SDKVersion,sid:n.SessionId,sl:n.SessionLength,ssd:n.SessionStartDate,dt:n.EventDataType,dbg:n.Debug,ct:n.Timestamp,lc:n.Location,o:n.OptOut,eec:n.ExpandedEventCount,av:n.AppVersion,cgid:n.ClientGeneratedId,das:n.DeviceId,mpid:n.MPID,smpids:n.currentSessionMPIDs},u=gu(n.ConsentState);return u&&(r.con=u),n.EventDataType===or.AppStateTransition&&(r.fr=t,r.iu=!1,r.at=ls.AppInit,r.lr=window.location.href||null,r.attrs=null),n.CustomFlags&&as(n,r),n.EventDataType===or.Commerce?(r.cu=i,n.ShoppingCart&&(r.sc={pl:sr(n.ShoppingCart.ProductList)}),n.ProductAction?r.pd={an:n.ProductAction.ProductActionType,cs:ft(n.ProductAction.CheckoutStep),co:n.ProductAction.CheckoutOptions,pl:sr(n.ProductAction.ProductList),ti:n.ProductAction.TransactionId,ta:n.ProductAction.Affiliation,tcc:n.ProductAction.CouponCode,tr:ft(n.ProductAction.TotalAmount),ts:ft(n.ProductAction.ShippingAmount),tt:ft(n.ProductAction.TaxAmount)}:n.PromotionAction?r.pm={an:n.PromotionAction.PromotionActionType,pl:n.PromotionAction.PromotionList.map(function(n){return{id:n.Id,nm:n.Name,cr:n.Creative,ps:n.Position?n.Position:0}})}:n.ProductImpressions&&(r.pi=n.ProductImpressions.map(function(n){return{pil:n.ProductImpressionList,pl:sr(n.ProductList)}}))):n.EventDataType===or.Profile&&(r.pet=n.ProfileMessageType),r}function nf(i,u){return{getUserIdentities:function(){var f={},e=r.getUserIdentities(i);for(var o in e)e.hasOwnProperty(o)&&(f[t.IdentityType.getIdentityName(n.parseNumber(o))]=e[o]);return f=n.filterUserIdentitiesForForwarders(f,u.userIdentityFilters),{userIdentities:f}},getMPID:function(){return i},getUserAttributesLists:function(t){var i,u={},r;i=this.getAllUserAttributes();for(r in i)i.hasOwnProperty(r)&&Array.isArray(i[r])&&(u[r]=i[r].slice());return n.filterUserAttributes(u,t.userAttributeFilters)},getAllUserAttributes:function(){var e={},t=r.getAllUserAttributes(i),f;if(t)for(f in t)t.hasOwnProperty(f)&&(e[f]=Array.isArray(t[f])?t[f].slice():t[f]);return n.filterUserAttributes(e,u.userAttributeFilters)}}}function tf(i,r,f){var s,l=mParticle.Identity.getCurrentUser(),e,v,h,c,o;if(l&&(s=l.getMPID()),mParticle.Store.webviewBridgeEnabled)a.sendToNative(u.NativeSdkPaths.LogEvent,JSON.stringify(i));else{if(v=function(){e.readyState===4&&(mParticle.Logger.verbose("Received "+e.statusText+" from server"),f(e.responseText))},mParticle.Logger.verbose(et.InformationMessages.SendBegin),h=[],n.isObject(i.UserIdentities)&&Object.keys(i.UserIdentities).length){for(c in i.UserIdentities)o={},o.Identity=i.UserIdentities[c],o.Type=n.parseNumber(c),h.push(o);i.UserIdentities=h}else i.UserIdentities=[];if(mParticle.Store.requireDelay=n.isDelayedByIntegration(mParticle.preInit.integrationDelays,mParticle.Store.integrationDelayTimeoutStart,Date.now()),s&&!mParticle.Store.requireDelay&&mParticle.Store.configurationLoaded){if(n.processQueuedEvents(mParticle.Store.eventQueue,s,!mParticle.Store.requiredDelay,tf,r,f),!i){mParticle.Logger.error(et.ErrorMessages.EventEmpty);return}if(mParticle.Logger.verbose(et.InformationMessages.SendHttp),e=n.createXHR(v),e)try{e.open("post",n.createServiceUrl(mParticle.Store.SDKConfig.v2SecureServiceUrl,mParticle.Store.devToken)+"/Events");e.send(JSON.stringify(g.convertEventToDTO(i,mParticle.Store.isFirstRun,mParticle.Store.currencyCode,mParticle.Store.integrationAttributes)));i.EventName!==t.MessageType.AppStateTransition&&r(i)}catch(y){mParticle.Logger.error("Error sending event to mParticle servers. "+y)}}else mParticle.Logger.verbose("Event was added to eventQueue. eventQueue will be processed once a valid MPID is returned or there is no more integration imposed delay."),mParticle.Store.eventQueue.push(i)}}function ws(t,i){var r,f=function(){var t,u;if(r.readyState===4){if(mParticle.Logger.verbose("Received "+r.statusText+" from server"),r.status!==200&&r.status!==202&&r.responseText&&(t=JSON.parse(r.responseText),t.hasOwnProperty("message"))){u=t.message;n.invokeAliasCallback(i,r.status,u);return}n.invokeAliasCallback(i,r.status)}};if(mParticle.Logger.verbose(et.InformationMessages.SendAliasHttp),r=n.createXHR(f),r)try{r.open("post",n.createServiceUrl(mParticle.Store.SDKConfig.aliasUrl,mParticle.Store.devToken)+"/Alias");r.send(JSON.stringify(t))}catch(u){n.invokeAliasCallback(i,vi.noHttpCoverage,u);mParticle.Logger.error("Error sending alias request to mParticle servers. "+u)}}function bs(t,i,r,u,f,e){var o,s,c=function(){o.readyState===4&&(mParticle.Logger.verbose("Received "+o.statusText+" from server"),f(o,s,r,u,i))};if(mParticle.Logger.verbose(et.InformationMessages.SendIdentityBegin),!t){mParticle.Logger.error(et.ErrorMessages.APIRequestEmpty);return}if(mParticle.Logger.verbose(et.InformationMessages.SendIdentityHttp),o=n.createXHR(c),o)try{mParticle.Store.identityCallInFlight?n.invokeCallback(r,vi.activeIdentityRequest,"There is currently an Identity request processing. Please wait for this to return before requesting again"):(s=e||null,i==="modify"?o.open("post",n.createServiceUrl(mParticle.Store.SDKConfig.identityUrl)+e+"/"+i):o.open("post",n.createServiceUrl(mParticle.Store.SDKConfig.identityUrl)+i),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("x-mp-key",mParticle.Store.devToken),mParticle.Store.identityCallInFlight=!0,o.send(JSON.stringify(t)))}catch(h){mParticle.Store.identityCallInFlight=!1;n.invokeCallback(r,vi.noHttpCoverage,h);mParticle.Logger.error("Error sending identity request to servers with status code "+o.status+" - "+h)}}function ks(t,i){var r,u;try{r=n.createServiceUrl(mParticle.Store.SDKConfig.v2SecureServiceUrl,mParticle.Store.devToken);u={uuid:n.generateUniqueId(),data:t};i&&(i.open("post",r+"/Forwarding"),i.send(JSON.stringify(u)))}catch(f){mParticle.Logger.error("Error sending forwarding stats to mParticle servers.")}}function ds(t){var r,u,f,i;try{f=function(){i.readyState===4&&i.status===202&&mParticle.Logger.verbose("Successfully sent  "+i.statusText+" from server")};i=n.createXHR(f);r=n.createServiceUrl(mParticle.Store.SDKConfig.v1SecureServiceUrl,mParticle.Store.devToken);u=t;i&&(i.open("post",r+"/Forwarding"),i.send(JSON.stringify(u)))}catch(e){mParticle.Logger.error("Error sending forwarding stats to mParticle servers.")}}function gs(t,i,r){var e,o,f;try{o=function(){f.readyState===4&&(f.status===200?(i=n.extend({},i,JSON.parse(f.responseText)),r(t,i),mParticle.Logger.verbose("Successfully received configuration from server")):(r(t,i),mParticle.Logger.verbose("Issue with receiving configuration from server, received HTTP Code of "+f.status)))};f=n.createXHR(o);e="https://"+u.DefaultUrls.configUrl+t+"/config?env=";e=i.isDevelopmentMode?e+"1":e+"0";f&&(f.open("get",e),f.send(null))}catch(s){r(t,i);mParticle.Logger.error("Error getting forwarder configuration from mParticle servers.")}}function rf(t){var i=mParticle.Identity.getCurrentUser();!mParticle.Store.webviewBridgeEnabled&&mParticle.Store.configuredForwarders&&(mParticle.Store.configuredForwarders.sort(function(n,t){return n.settings.PriorityValue=n.settings.PriorityValue||0,t.settings.PriorityValue=t.settings.PriorityValue||0,-1*(n.settings.PriorityValue-t.settings.PriorityValue)}),mParticle.Store.activeForwarders=mParticle.Store.configuredForwarders.filter(function(r){if(!uf(r.filteringConsentRuleValues,i)||!ff(r.filteringUserAttributeValue,i)||!nh(r.excludeAnonymousUser,i))return!1;var u=n.filterUserIdentities(t,r.userIdentityFilters),f=n.filterUserAttributes(i?i.getAllUserAttributes():{},r.userAttributeFilters);return r.initialized||(r.init(r.settings,oh,!1,null,f,u,mParticle.Store.SDKConfig.appVersion,mParticle.Store.SDKConfig.appName,mParticle.Store.SDKConfig.customFlags,mParticle.Store.clientId),r.initialized=!0),!0}))}function uf(t,i){var r,u,s,f;if(!t||!t.values||!t.values.length)return!0;if(!i)return!1;var e={},o=i.getConsentState();if(o&&(r=o.getGDPRConsentState(),r))for(u in r)r.hasOwnProperty(u)&&(s=n.generateHash("1"+u).toString(),e[s]=r[u].Consented);return f=!1,t.values.forEach(function(n){if(!f){var t=n.consentPurpose,i=n.hasConsented;e.hasOwnProperty(t)&&e[t]===i&&(f=!0)}}),t.includeOnMatch===f}function ff(t,i){var e,o,r,f,u;if(!t||!n.isObject(t)||!Object.keys(t).length)return!0;if(i)r=i.getAllUserAttributes();else return!1;f=!1;try{if(r&&n.isObject(r)&&Object.keys(r).length)for(u in r)if(r.hasOwnProperty(u)&&(e=n.generateHash(u).toString(),o=n.generateHash(r[u]).toString(),e===t.userAttributeName&&o===t.userAttributeValue)){f=!0;break}return t?t.includeOnMatch===f:!0}catch(s){return!0}}function nh(n,t){return(!t||!t.isLoggedIn())&&n?!1:!0}function th(n,t){mParticle.Store.activeForwarders.length&&mParticle.Store.activeForwarders.forEach(function(i){var u=i[n],r;if(u)try{r=i[n](t);r&&mParticle.Logger.verbose(r)}catch(f){mParticle.Logger.verbose(f)}})}function ih(i){var u,o,s,p=function(t,i){t.UserIdentities&&t.UserIdentities.length&&t.UserIdentities.forEach(function(r,u){n.inArray(i,r.Type)&&(t.UserIdentities.splice(u,1),u>0&&u--)})},v=function(t,i){var u,r;if(i)for(r in t.EventAttributes)t.EventAttributes.hasOwnProperty(r)&&(u=n.generateHash(t.EventCategory+t.EventName+r),n.inArray(i,u)&&delete t.EventAttributes[r])},e=function(t,i){return t&&t.length&&n.inArray(t,i)?!0:!1},w=[t.MessageType.PageEvent,t.MessageType.PageView,t.MessageType.Commerce],r,f,h,c,l,y,a;if(!mParticle.Store.webviewBridgeEnabled&&mParticle.Store.activeForwarders)for(o=n.generateHash(i.EventCategory+i.EventName),s=n.generateHash(i.EventCategory),r=0;r<mParticle.Store.activeForwarders.length;r++){if(w.indexOf(i.EventDataType)>-1&&mParticle.Store.activeForwarders[r].filteringEventAttributeValue&&mParticle.Store.activeForwarders[r].filteringEventAttributeValue.eventAttributeName&&mParticle.Store.activeForwarders[r].filteringEventAttributeValue.eventAttributeValue){if(f=null,i.EventAttributes)for(h in i.EventAttributes)if(c=n.generateHash(h).toString(),c===mParticle.Store.activeForwarders[r].filteringEventAttributeValue.eventAttributeName&&(f={name:c,value:n.generateHash(i.EventAttributes[h]).toString()}),f)break;if(l=f!==null&&f.value===mParticle.Store.activeForwarders[r].filteringEventAttributeValue.eventAttributeValue,y=mParticle.Store.activeForwarders[r].filteringEventAttributeValue.includeOnMatch===!0?l:!l,!y)continue}if(u={},u=n.extend(!0,u,i),i.EventDataType===t.MessageType.PageEvent&&(e(mParticle.Store.activeForwarders[r].eventNameFilters,o)||e(mParticle.Store.activeForwarders[r].eventTypeFilters,s)))continue;else if(i.EventDataType===t.MessageType.Commerce&&e(mParticle.Store.activeForwarders[r].eventTypeFilters,s))continue;else if(i.EventDataType===t.MessageType.PageView&&e(mParticle.Store.activeForwarders[r].screenNameFilters,o))continue;u.EventAttributes&&(i.EventDataType===t.MessageType.PageEvent?v(u,mParticle.Store.activeForwarders[r].attributeFilters):i.EventDataType===t.MessageType.PageView&&v(u,mParticle.Store.activeForwarders[r].pageViewAttributeFilters));p(u,mParticle.Store.activeForwarders[r].userIdentityFilters);u.UserAttributes=n.filterUserAttributes(u.UserAttributes,mParticle.Store.activeForwarders[r].userAttributeFilters);mParticle.Logger.verbose("Sending message to forwarder: "+mParticle.Store.activeForwarders[r].name);mParticle.Store.activeForwarders[r].process&&(a=mParticle.Store.activeForwarders[r].process(u),a&&mParticle.Logger.verbose(a))}}function rh(t,i){mParticle.Store.activeForwarders.length&&mParticle.Store.activeForwarders.forEach(function(r){if(r.setUserAttribute&&r.userAttributeFilters&&!n.inArray(r.userAttributeFilters,n.generateHash(t)))try{var u=r.setUserAttribute(t,i);u&&mParticle.Logger.verbose(u)}catch(f){mParticle.Logger.error(f)}})}function uh(t){mParticle.Store.activeForwarders.forEach(function(i){var r=n.filterUserIdentities(t,i.userIdentityFilters);i.setUserIdentity&&r.forEach(function(n){var t=i.setUserIdentity(n.Identity,n.Type);t&&mParticle.Logger.verbose(t)})})}function fh(n){mParticle.Store.activeForwarders.forEach(function(t){var r=nf(n.getMPID(),t),i;t.onUserIdentified&&(i=t.onUserIdentified(r),i&&mParticle.Logger.verbose(i))})}function eh(n,t){var i;mParticle.Store.activeForwarders.forEach(function(r){var u=nf(n.getMPID(),r);t==="identify"?r.onIdentifyComplete&&(i=r.onIdentifyComplete(u),i&&mParticle.Logger.verbose(i)):t==="login"?r.onLoginComplete&&(i=r.onLoginComplete(u),i&&mParticle.Logger.verbose(i)):t==="logout"?r.onLogoutComplete&&(i=r.onLogoutComplete(u),i&&mParticle.Logger.verbose(i)):t==="modify"&&r.onModifyComplete&&(i=r.onModifyComplete(u),i&&mParticle.Logger.verbose(i))})}function oh(t,i){var r,f=ef();t&&t.isVisible&&(r={mid:t.id,esid:t.eventSubscriptionId,n:i.EventName,attrs:i.EventAttributes,sdk:i.SDKVersion,dt:i.EventDataType,et:i.EventCategory,dbg:i.Debug,ct:i.Timestamp,eec:i.ExpandedEventCount},n.hasFeatureFlag(u.Features.Batching)?(f.push(r),of(f)):ot.sendSingleForwardingStatsToServer(r))}function ef(){return r.forwardingStatsBatches.forwardingStatsEventQueue}function of(n){r.forwardingStatsBatches.forwardingStatsEventQueue=n}function sh(t){var r=null,i=t,u={},f;n.isObject(mParticle.Store.SDKConfig.kits)&&Object.keys(mParticle.Store.SDKConfig.kits).length>0?u=mParticle.Store.SDKConfig.kits:mParticle.preInit.forwarderConstructors.length>0&&mParticle.preInit.forwarderConstructors.forEach(function(n){u[n.name]=n});for(f in u)if(f===i.name&&(i.isDebug===mParticle.Store.SDKConfig.isDevelopmentMode||i.isSandbox===mParticle.Store.SDKConfig.isDevelopmentMode)){r=new u[f].constructor;r.id=i.moduleId;r.isSandbox=i.isDebug||i.isSandbox;r.hasSandbox=i.hasDebugString==="true";r.isVisible=i.isVisible;r.settings=i.settings;r.eventNameFilters=i.eventNameFilters;r.eventTypeFilters=i.eventTypeFilters;r.attributeFilters=i.attributeFilters;r.screenNameFilters=i.screenNameFilters;r.screenNameFilters=i.screenNameFilters;r.pageViewAttributeFilters=i.pageViewAttributeFilters;r.userIdentityFilters=i.userIdentityFilters;r.userAttributeFilters=i.userAttributeFilters;r.filteringEventAttributeValue=i.filteringEventAttributeValue;r.filteringUserAttributeValue=i.filteringUserAttributeValue;r.eventSubscriptionId=i.eventSubscriptionId;r.filteringConsentRuleValues=i.filteringConsentRuleValues;r.excludeAnonymousUser=i.excludeAnonymousUser;mParticle.Store.configuredForwarders.push(r);break}}function sf(n){(n.isDebug===mParticle.Store.SDKConfig.isDevelopmentMode||n.isProduction!==mParticle.Store.SDKConfig.isDevelopmentMode)&&mParticle.Store.pixelConfigurations.push(n)}function hh(n){if(n)try{Array.isArray(n.kitConfigs)&&n.kitConfigs.length&&n.kitConfigs.forEach(function(n){sh(n)});Array.isArray(n.pixelConfigs)&&n.pixelConfigs.length&&n.pixelConfigs.forEach(function(n){sf(n)});rf(mParticle.Store.SDKConfig.identifyRequest.userIdentities)}catch(t){mParticle.Logger.error("Config was not parsed propertly. Forwarders may not be initialized.")}else mParticle.Logger.warning("No config was passed. Cannot process forwarders")}function ch(n,t){t.TransactionId=n.Id;t.Affiliation=n.Affiliation;t.CouponCode=n.CouponCode;t.TotalAmount=n.Revenue;t.ShippingAmount=n.Shipping;t.TaxAmount=n.Tax}function lh(n){switch(n){case t.ProductActionType.AddToCart:return"AddToCart";case t.ProductActionType.AddToWishlist:return"AddToWishlist";case t.ProductActionType.Checkout:return"Checkout";case t.ProductActionType.CheckoutOption:return"CheckoutOption";case t.ProductActionType.Click:return"Click";case t.ProductActionType.Purchase:return"Purchase";case t.ProductActionType.Refund:return"Refund";case t.ProductActionType.RemoveFromCart:return"RemoveFromCart";case t.ProductActionType.RemoveFromWishlist:return"RemoveFromWishlist";case t.ProductActionType.ViewDetail:return"ViewDetail";case t.ProductActionType.Unknown:default:return"Unknown"}}function ah(n){switch(n){case t.PromotionActionType.PromotionClick:return"PromotionClick";case t.PromotionActionType.PromotionView:return"PromotionView";default:return"Unknown"}}function vh(n){switch(n){case t.ProductActionType.AddToCart:return t.CommerceEventType.ProductAddToCart;case t.ProductActionType.AddToWishlist:return t.CommerceEventType.ProductAddToWishlist;case t.ProductActionType.Checkout:return t.CommerceEventType.ProductCheckout;case t.ProductActionType.CheckoutOption:return t.CommerceEventType.ProductCheckoutOption;case t.ProductActionType.Click:return t.CommerceEventType.ProductClick;case t.ProductActionType.Purchase:return t.CommerceEventType.ProductPurchase;case t.ProductActionType.Refund:return t.CommerceEventType.ProductRefund;case t.ProductActionType.RemoveFromCart:return t.CommerceEventType.ProductRemoveFromCart;case t.ProductActionType.RemoveFromWishlist:return t.CommerceEventType.ProductRemoveFromWishlist;case t.ProductActionType.Unknown:return t.EventType.Unknown;case t.ProductActionType.ViewDetail:return t.CommerceEventType.ProductViewDetail;default:return mParticle.Logger.error("Could not convert product action type "+n+" to event type"),null}}function yh(n){switch(n){case t.PromotionActionType.PromotionClick:return t.CommerceEventType.PromotionClick;case t.PromotionActionType.PromotionView:return t.CommerceEventType.PromotionView;default:return mParticle.Logger.error("Could not convert promotion action type "+n+" to event type"),null}}function wi(n,t){return"eCommerce - "+n+" - "+(t?"Total":"Item")}function hf(n,t){t.CouponCode&&(n["Coupon Code"]=t.CouponCode);t.Brand&&(n.Brand=t.Brand);t.Category&&(n.Category=t.Category);t.Name&&(n.Name=t.Name);t.Sku&&(n.Id=t.Sku);t.Price&&(n["Item Price"]=t.Price);t.Quantity&&(n.Quantity=t.Quantity);t.Position&&(n.Position=t.Position);t.Variant&&(n.Variant=t.Variant);n["Total Product Amount"]=t.TotalAmount||0}function cf(n,t){t.TransactionId&&(n["Transaction Id"]=t.TransactionId)}function lf(n,t){cf(n,t);t.Affiliation&&(n.Affiliation=t.Affiliation);t.CouponCode&&(n["Coupon Code"]=t.CouponCode);t.TotalAmount&&(n["Total Amount"]=t.TotalAmount);t.ShippingAmount&&(n["Shipping Amount"]=t.ShippingAmount);t.TaxAmount&&(n["Tax Amount"]=t.TaxAmount);t.CheckoutOptions&&(n["Checkout Options"]=t.CheckoutOptions);t.CheckoutStep&&(n["Checkout Step"]=t.CheckoutStep)}function ph(n,t){t.Id&&(n.Id=t.Id);t.Creative&&(n.Creative=t.Creative);t.Name&&(n.Name=t.Name);t.Position&&(n.Position=t.Position)}function wh(n,t){return t?Array.isArray(t)?t:[t]:n.ShoppingCart.ProductList}function bh(t,i,r,u,f,e,o,s,h,c){return(c=n.sanitizeAttributes(c),typeof t!="string")?(mParticle.Logger.error("Name is required when creating a product"),null):yi.isStringOrNumber(i)?yi.isStringOrNumber(r)?(u||(u=1),{Name:t,Sku:i,Price:r,Quantity:u,Brand:o,Variant:f,Category:e,Position:s,CouponCode:h,TotalAmount:u*r,Attributes:c}):(mParticle.Logger.error("Price is required when creating a product, and must be a string or a number"),null):(mParticle.Logger.error("SKU is required when creating a product, and must be a string or a number"),null)}function kh(n,t,i,r){return yi.isStringOrNumber(n)?{Id:n,Creative:t,Name:i,Position:r}:(mParticle.Logger.error(pi.ErrorMessages.PromotionIdRequired),null)}function dh(n,t){return typeof n!="string"?(mParticle.Logger.error("Name is required when creating an impression."),null):t?{Name:n,Product:t}:(mParticle.Logger.error("Product is required when creating an impression."),null)}function gh(n,t,i,r,u,f){return yi.isStringOrNumber(n)?{Id:n,Affiliation:t,CouponCode:i,Revenue:r,Shipping:u,Tax:f}:(mParticle.Logger.error(pi.ErrorMessages.TransactionIdRequired),null)}function nc(i){var r=[];return i.ProductImpressions?(i.ProductImpressions.forEach(function(u){u.ProductList&&u.ProductList.forEach(function(f){var e=n.extend(!1,{},i.EventAttributes),o,s;if(f.Attributes)for(o in f.Attributes)e[o]=f.Attributes[o];hf(e,f);u.ProductImpressionList&&(e["Product Impression List"]=u.ProductImpressionList);s=g.createEventObject(t.MessageType.PageEvent,wi("Impression"),e,t.EventType.Transaction);r.push(s)})}),r):r}function tc(n){return n?rc(n).concat(ic(n)).concat(nc(n)):null}function ic(i){var r=[],u;return i.PromotionAction?(u=i.PromotionAction.PromotionList,u.forEach(function(u){var f=n.extend(!1,{},i.EventAttributes),e;ph(f,u);e=g.createEventObject(t.MessageType.PageEvent,wi(t.PromotionActionType.getExpansionName(i.PromotionAction.PromotionActionType)),f,t.EventType.Transaction);r.push(e)}),r):r}function rc(i){var r=[],f,u,o,e;return i.ProductAction?(f=!1,i.ProductAction.ProductActionType===t.ProductActionType.Purchase||i.ProductAction.ProductActionType===t.ProductActionType.Refund?(u=n.extend(!1,{},i.EventAttributes),u["Product Count"]=i.ProductAction.ProductList?i.ProductAction.ProductList.length:0,lf(u,i.ProductAction),i.CurrencyCode&&(u["Currency Code"]=i.CurrencyCode),o=g.createEventObject(t.MessageType.PageEvent,wi(t.ProductActionType.getExpansionName(i.ProductAction.ProductActionType),!0),u,t.EventType.Transaction),r.push(o)):f=!0,e=i.ProductAction.ProductList,!e)?r:(e.forEach(function(u){var e=n.extend(!1,i.EventAttributes,u.Attributes),o;f?lf(e,i.ProductAction):cf(e,i.ProductAction);hf(e,u);o=g.createEventObject(t.MessageType.PageEvent,wi(t.ProductActionType.getExpansionName(i.ProductAction.ProductActionType)),e,t.EventType.Transaction);r.push(o)}),r):r}function uc(i){var r,u=mParticle.Identity.getCurrentUser();return(mParticle.Logger.verbose(pi.InformationMessages.StartingLogCommerceEvent),n.canLog())?(r=g.createEventObject(t.MessageType.Commerce),r.EventName="eCommerce - ",r.CurrencyCode=mParticle.Store.currencyCode,r.ShoppingCart={ProductList:u?u.getCart().getCartProducts():[]},r.CustomFlags=i,r):(mParticle.Logger.verbose(pi.InformationMessages.AbandonLogEvent),null)}function lr(t,i,u,f,e){mParticle.Logger.verbose(bt.InformationMessages.StartingLogEvent+": "+i);n.canLog()?(u&&(u=n.sanitizeAttributes(u)),hr(g.createEventObject(t,i,u,f,e),cr,bi),r.update()):mParticle.Logger.verbose(bt.InformationMessages.AbandonLogEvent)}function bi(n){var f=new Date,t,i,u;if(n)try{if(mParticle.Logger.verbose("Parsing response from server"),t=JSON.parse(n),t&&t.Store){mParticle.Logger.verbose("Parsed store from response, updating local settings");mParticle.Store.serverSettings||(mParticle.Store.serverSettings={});for(i in t.Store)t.Store.hasOwnProperty(i)&&(u=t.Store[i],!u.Value||new Date(u.Expires)<f?mParticle.Store.serverSettings.hasOwnProperty(i)&&delete mParticle.Store.serverSettings[i]:mParticle.Store.serverSettings[i]=u);r.update()}}catch(e){mParticle.Logger.error("Error parsing JSON response from server: "+e.name)}}function fc(n){function r(i){mParticle.Store.currentPosition={lat:i.coords.latitude,lng:i.coords.longitude};t(n,i);n=null;mParticle.Store.isTracking=!0}function u(){t(n);n=null;mParticle.Store.isTracking=!1}function t(n,t){if(n)try{t?n(t):n()}catch(i){mParticle.Logger.error("Error invoking the callback passed to startTrackingLocation.");mParticle.Logger.error(i)}}if(mParticle.Store.isTracking){var i={coords:{latitude:mParticle.Store.currentPosition.lat,longitude:mParticle.Store.currentPosition.lng}};t(n,i)}else"geolocation"in navigator&&(mParticle.Store.watchPositionId=navigator.geolocation.watchPosition(r,u))}function ec(){mParticle.Store.isTracking&&(navigator.geolocation.clearWatch(mParticle.Store.watchPositionId),mParticle.Store.currentPosition=null,mParticle.Store.isTracking=!1)}function oc(){mParticle.Logger.verbose(bt.InformationMessages.StartingLogOptOut);hr(g.createEventObject(t.MessageType.OptOut,null,null,t.EventType.Other),cr,bi)}function sc(){lr(t.MessageType.AppStateTransition)}function hc(n,i,r,u){var f=s.createCommerceEventObject(u);f&&(f.EventName+=s.getProductActionEventName(t.ProductActionType.Checkout),f.EventCategory=t.CommerceEventType.ProductCheckout,f.ProductAction={ProductActionType:t.ProductActionType.Checkout,CheckoutStep:n,CheckoutOptions:i,ProductList:f.ShoppingCart.ProductList},kt(f,r))}function cc(n,t,i,r){var u=s.createCommerceEventObject(r);u&&(u.EventCategory=s.convertProductActionToEventType(n),u.EventName+=s.getProductActionEventName(n),u.ProductAction={ProductActionType:n,ProductList:Array.isArray(t)?t:[t]},kt(u,i))}function lc(n,i,r,u){var f=s.createCommerceEventObject(u);f&&(f.EventName+=s.getProductActionEventName(t.ProductActionType.Purchase),f.EventCategory=t.CommerceEventType.ProductPurchase,f.ProductAction={ProductActionType:t.ProductActionType.Purchase},f.ProductAction.ProductList=s.buildProductList(f,i),s.convertTransactionAttributesToProductAction(n,f.ProductAction),kt(f,r))}function ac(n,i,r,u){if(!n){mParticle.Logger.error(bt.ErrorMessages.TransactionRequired);return}var f=s.createCommerceEventObject(u);f&&(f.EventName+=s.getProductActionEventName(t.ProductActionType.Refund),f.EventCategory=t.CommerceEventType.ProductRefund,f.ProductAction={ProductActionType:t.ProductActionType.Refund},f.ProductAction.ProductList=s.buildProductList(f,i),s.convertTransactionAttributesToProductAction(n,f.ProductAction),kt(f,r))}function vc(n,t,i,r){var u=s.createCommerceEventObject(r);u&&(u.EventName+=s.getPromotionActionEventName(n),u.EventCategory=s.convertPromotionActionToEventType(n),u.PromotionAction={PromotionActionType:n,PromotionList:[t]},kt(u,i))}function yc(n,i,r){var u=s.createCommerceEventObject(r);u&&(u.EventName+="Impression",u.EventCategory=t.CommerceEventType.ProductImpression,Array.isArray(n)||(n=[n]),u.ProductImpressions=[],n.forEach(function(n){u.ProductImpressions.push({ProductImpressionList:n.Name,ProductList:Array.isArray(n.Product)?n.Product:[n.Product]})}),kt(u,i))}function kt(t,i){mParticle.Logger.verbose(bt.InformationMessages.StartingLogCommerceEvent);i=n.sanitizeAttributes(i);n.canLog()?(mParticle.Store.webviewBridgeEnabled&&(t.ShoppingCart={}),i&&(t.EventAttributes=i),hr(t,cr,bi),r.update()):mParticle.Logger.verbose(bt.InformationMessages.AbandonLogEvent)}function pc(n,i,r,u,f){var o=[],h=function(n){var i=function(){e.href?window.location.href=e.href:e.submit&&e.submit()};mParticle.Logger.verbose("DOM event triggered, handling event");lr(t.MessageType.PageEvent,typeof r=="function"?r(e):r,typeof u=="function"?u(e):u,f||t.EventType.Other);(e.href&&e.target!=="_blank"||e.submit)&&(n.preventDefault?n.preventDefault():n.returnValue=!1,setTimeout(i,mParticle.Store.SDKConfig.timeout))},e,s;if(!i){mParticle.Logger.error("Can't bind event, selector is required");return}if(typeof i=="string"?o=document.querySelectorAll(i):i.nodeType&&(o=[i]),o.length)for(mParticle.Logger.verbose("Found "+o.length+" element"+(o.length>1?"s":"")+", attaching event handlers"),s=0;s<o.length;s++)e=o[s],e.addEventListener?e.addEventListener(n,h,!1):e.attachEvent?e.attachEvent("on"+n,h):e["on"+n]=h;else mParticle.Logger.verbose("No elements found")}function af(n,t,i){if(n&&t&&n!==t){var u=r.useLocalStorage()?r.getLocalStorage():r.getCookie();u.cu=t;u.gs.csm=i;r.saveCookies(u)}}function ei(i,f){return{getUserIdentities:function(){var e={},u=r.getUserIdentities(i);for(var f in u)u.hasOwnProperty(f)&&(e[t.IdentityType.getIdentityName(n.parseNumber(f))]=u[f]);return{userIdentities:e}},getMPID:function(){return i},setUserTag:function(n){if(!st.isValidKeyValue(n)){mParticle.Logger.error(h.ErrorMessages.BadKey);return}this.setUserAttribute(n,null)},removeUserTag:function(n){if(!st.isValidKeyValue(n)){mParticle.Logger.error(h.ErrorMessages.BadKey);return}this.removeUserAttribute(n)},setUserAttribute:function(t,f){var e,o,s;if(mParticle.sessionManager.resetSessionTimer(),n.canLog()){if(!st.isValidAttributeValue(f)){mParticle.Logger.error(h.ErrorMessages.BadAttribute);return}if(!st.isValidKeyValue(t)){mParticle.Logger.error(h.ErrorMessages.BadKey);return}mParticle.Store.webviewBridgeEnabled?a.sendToNative(u.NativeSdkPaths.SetUserAttribute,JSON.stringify({key:t,value:f})):(e=r.getPersistence(),o=this.getAllUserAttributes(),s=n.findKeyInObject(o,t),s&&delete o[s],o[t]=f,e&&e[i]&&(e[i].ua=o,r.saveCookies(e,i)),c.initForwarders(at.getCurrentUser().getUserIdentities()),c.callSetUserAttributeOnForwarders(t,f))}},setUserAttributes:function(t){if(mParticle.sessionManager.resetSessionTimer(),n.isObject(t)){if(n.canLog())for(var i in t)t.hasOwnProperty(i)&&this.setUserAttribute(i,t[i])}else mParticle.Logger.error("Must pass an object into setUserAttributes. You passed a "+typeof t)},removeUserAttribute:function(t){var f,e,o;if(mParticle.sessionManager.resetSessionTimer(),!st.isValidKeyValue(t)){mParticle.Logger.error(h.ErrorMessages.BadKey);return}mParticle.Store.webviewBridgeEnabled?a.sendToNative(u.NativeSdkPaths.RemoveUserAttribute,JSON.stringify({key:t,value:null})):(f=r.getPersistence(),e=this.getAllUserAttributes(),o=n.findKeyInObject(e,t),o&&(t=o),delete e[t],f&&f[i]&&(f[i].ua=e,r.saveCookies(f,i)),c.initForwarders(at.getCurrentUser().getUserIdentities()),c.applyToForwarders("removeUserAttribute",t))},setUserAttributeList:function(t,f){var e,o,s,l;if(mParticle.sessionManager.resetSessionTimer(),!st.isValidKeyValue(t)){mParticle.Logger.error(h.ErrorMessages.BadKey);return}if(!Array.isArray(f)){mParticle.Logger.error("The value you passed in to setUserAttributeList must be an array. You passed in a "+typeof f);return}s=f.slice();mParticle.Store.webviewBridgeEnabled?a.sendToNative(u.NativeSdkPaths.SetUserAttributeList,JSON.stringify({key:t,value:s})):(e=r.getPersistence(),o=this.getAllUserAttributes(),l=n.findKeyInObject(o,t),l&&delete o[l],o[t]=s,e&&e[i]&&(e[i].ua=o,r.saveCookies(e,i)),c.initForwarders(at.getCurrentUser().getUserIdentities()),c.callSetUserAttributeOnForwarders(t,s))},removeAllUserAttributes:function(){var n,t,f;if(mParticle.sessionManager.resetSessionTimer(),mParticle.Store.webviewBridgeEnabled)a.sendToNative(u.NativeSdkPaths.RemoveAllUserAttributes);else{if(n=r.getPersistence(),t=this.getAllUserAttributes(),c.initForwarders(at.getCurrentUser().getUserIdentities()),t)for(f in t)t.hasOwnProperty(f)&&c.applyToForwarders("removeUserAttribute",f);n&&n[i]&&(n[i].ua={},r.saveCookies(n,i))}},getUserAttributesLists:function(){var n,i={},t;n=this.getAllUserAttributes();for(t in n)n.hasOwnProperty(t)&&Array.isArray(n[t])&&(i[t]=n[t].slice());return i},getAllUserAttributes:function(){var u={},n=r.getAllUserAttributes(i),t;if(n)for(t in n)n.hasOwnProperty(t)&&(u[t]=Array.isArray(n[t])?n[t].slice():n[t]);return u},getCart:function(){return vf(i)},getConsentState:function(){return r.getConsentState(i)},setConsentState:function(n){r.saveUserConsentStateToCookies(i,n);c.initForwarders(this.getUserIdentities().userIdentities)},isLoggedIn:function(){return f},getLastSeenTime:function(){return r.getLastSeenTime(i)},getFirstSeenTime:function(){return r.getFirstSeenTime(i)}}}function vf(i){return{add:function(f,e){var h,o,s,c;s=Array.isArray(f)?f.slice():[f];s.forEach(function(t){t.Attributes=n.sanitizeAttributes(t.Attributes)});mParticle.Store.webviewBridgeEnabled?a.sendToNative(u.NativeSdkPaths.AddToCart,JSON.stringify(s)):(mParticle.sessionManager.resetSessionTimer(),o=r.getUserProductsFromLS(i),o=o.concat(s),e===!0&&l.logProductActionEvent(t.ProductActionType.AddToCart,s),c={},c[i]={cp:o},o.length>mParticle.Store.SDKConfig.maxProducts&&(mParticle.Logger.verbose("The cart contains "+o.length+" items. Only "+mParticle.Store.SDKConfig.maxProducts+" can currently be saved in cookies."),o=o.slice(-mParticle.Store.SDKConfig.maxProducts)),h=r.getAllUserProductsFromLS(),h[i].cp=o,r.setCartProducts(h))},remove:function(n,f){var o,e,s=-1,h=null,c;mParticle.Store.webviewBridgeEnabled?a.sendToNative(u.NativeSdkPaths.RemoveFromCart,JSON.stringify(n)):(mParticle.sessionManager.resetSessionTimer(),e=r.getUserProductsFromLS(i),e&&(e.forEach(function(t,i){t.Sku===n.Sku&&(s=i,h=t)}),s>-1&&(e.splice(s,1),f===!0&&l.logProductActionEvent(t.ProductActionType.RemoveFromCart,h))),c={},c[i]={cp:e},o=r.getAllUserProductsFromLS(),o[i].cp=e,r.setCartProducts(o))},clear:function(){var n;mParticle.Store.webviewBridgeEnabled?a.sendToNative(u.NativeSdkPaths.ClearCart):(mParticle.sessionManager.resetSessionTimer(),n=r.getAllUserProductsFromLS(),n&&n[i]&&n[i].cp&&(n[i].cp=[],n[i].cp=[],r.setCartProducts(n)))},getCartProducts:function(){return r.getCartProducts(i)}}}function di(i,u,f,e,o){var h=mParticle.Identity.getCurrentUser(),a,s,w,b={},d=h?h.getUserIdentities().userIdentities:{},k,p,g,tt;for(k in d)b[t.IdentityType.getIdentityType(k)]=d[k];p={};mParticle.Store.identityCallInFlight=!1;try{if(mParticle.Logger.verbose('Parsing "'+o+'" identity response from server'),i.responseText&&(s=JSON.parse(i.responseText),s.hasOwnProperty("is_logged_in")&&(mParticle.Store.isLoggedIn=s.is_logged_in)),i.status===200){if(o==="modify"?(p=v.modifyUserIdentities(b,e.userIdentities),r.saveUserIdentitiesToCookies(h.getMPID(),p)):(s=JSON.parse(i.responseText),mParticle.Logger.verbose("Successfully parsed Identity Response"),(!h||h.getMPID()&&s.mpid&&s.mpid!==h.getMPID())&&(mParticle.Store.mpid=s.mpid,h&&r.setLastSeenTime(u),r.setFirstSeenTime(s.mpid)),o==="identify"&&h&&s.mpid===h.getMPID()&&r.setFirstSeenTime(s.mpid),w=mParticle.Store.currentSessionMPIDs.indexOf(s.mpid),mParticle.Store.sessionId&&s.mpid&&u!==s.mpid&&w<0&&mParticle.Store.currentSessionMPIDs.push(s.mpid),w>-1&&(mParticle.Store.currentSessionMPIDs=mParticle.Store.currentSessionMPIDs.slice(0,w).concat(mParticle.Store.currentSessionMPIDs.slice(w+1,mParticle.Store.currentSessionMPIDs.length)),mParticle.Store.currentSessionMPIDs.push(s.mpid)),r.saveUserIdentitiesToCookies(s.mpid,p),wt.attemptCookieSync(u,s.mpid),af(u,s.mpid,mParticle.Store.currentSessionMPIDs),Object.keys(mParticle.Store.migrationData).length?(p=mParticle.Store.migrationData.userIdentities||{},g=mParticle.Store.migrationData.userAttributes||{},r.saveUserAttributesToCookies(s.mpid,g)):e&&e.userIdentities&&Object.keys(e.userIdentities).length&&(p=v.modifyUserIdentities(b,e.userIdentities)),r.saveUserIdentitiesToCookies(s.mpid,p),r.update(),r.findPrevCookiesBasedOnUI(e),mParticle.Store.context=s.context||mParticle.Store.context),a=at.getCurrentUser(),e&&e.onUserAlias&&n.Validators.isFunction(e.onUserAlias))try{mParticle.Logger.warning("Deprecated function onUserAlias will be removed in future releases");e.onUserAlias(h,a)}catch(nt){mParticle.Logger.error("There was an error with your onUserAlias function - "+nt)}tt=r.getCookie()||r.getLocalStorage();a&&(r.storeDataInMemory(tt,a.getMPID()),h&&a.getMPID()===h.getMPID()&&h.isLoggedIn()===a.isLoggedIn()||c.initForwarders(a.getUserIdentities().userIdentities),c.setForwarderUserIdentities(a.getUserIdentities().userIdentities),c.setForwarderOnIdentityComplete(a,o),c.setForwarderOnUserIdentified(a,o));n.processQueuedEvents(mParticle.Store.eventQueue,s.mpid,!mParticle.Store.requireDelay,ot.sendEventToServer,wc,l.parseEventResponse)}f?i.status===0?n.invokeCallback(f,y.noHttpCoverage,s||null,a):n.invokeCallback(f,i.status,s||null,a):s&&s.errors&&s.errors.length&&mParticle.Logger.error("Received HTTP response code of "+i.status+" - "+s.errors[0].message)}catch(nt){f&&n.invokeCallback(f,i.status,s||null);mParticle.Logger.error("Error parsing JSON response from Identity server: "+nt)}}function bc(){var t,n;mParticle.Store.sessionId?(t=mParticle.Store.SDKConfig.sessionTimeout*6e4,new Date>new Date(mParticle.Store.dateLastEventSent.getTime()+t)?(vr(),si()):(n=r.getPersistence(),n&&!n.cu&&(yf.identify(mParticle.Store.SDKConfig.identifyRequest,mParticle.Store.SDKConfig.identityCallback),mParticle.Store.identifyCalled=!0,mParticle.Store.SDKConfig.identityCallback=null))):si()}function kc(){return mParticle.Store.sessionId}function si(){var i,r,u;mParticle.Logger.verbose(oi.InformationMessages.StartingNewSession);n.canLog()?(mParticle.Store.sessionId=n.generateUniqueId().toUpperCase(),i=mParticle.Identity.getCurrentUser(),r=i?i.getMPID():null,r&&(mParticle.Store.currentSessionMPIDs=[r]),mParticle.Store.sessionStartDate||(u=new Date,mParticle.Store.sessionStartDate=u,mParticle.Store.dateLastEventSent=u),gi(),mParticle.Store.identifyCalled||(yf.identify(mParticle.Store.SDKConfig.identifyRequest,mParticle.Store.SDKConfig.identityCallback),mParticle.Store.identifyCalled=!0,mParticle.Store.SDKConfig.identityCallback=null),ar(t.MessageType.SessionStart)):mParticle.Logger.verbose(oi.InformationMessages.AbandonStartSession)}function vr(i){var f,u,e,o;if(mParticle.Logger.verbose(oi.InformationMessages.StartingEndSession),i)ar(t.MessageType.SessionEnd),mParticle.Store.sessionId=null,mParticle.Store.dateLastEventSent=null,mParticle.Store.sessionAttributes={},r.update();else if(n.canLog()){if(u=r.getCookie()||r.getLocalStorage(),!u)return;if(u.gs&&!u.gs.sid){mParticle.Logger.verbose(oi.InformationMessages.NoSessionToEnd);return}u.gs.sid&&mParticle.Store.sessionId!==u.gs.sid&&(mParticle.Store.sessionId=u.gs.sid);u.gs&&u.gs.les&&(f=mParticle.Store.SDKConfig.sessionTimeout*6e4,o=(new Date).getTime(),e=o-u.gs.les,e<f?gi():(ar(t.MessageType.SessionEnd),mParticle.Store.sessionId=null,mParticle.Store.dateLastEventSent=null,mParticle.Store.sessionStartDate=null,mParticle.Store.sessionAttributes={},r.update()))}else mParticle.Logger.verbose(oi.InformationMessages.AbandonEndSession)}function gi(){var n=mParticle.Store.SDKConfig.sessionTimeout*6e4;mParticle.Store.globalTimer=window.setTimeout(function(){vr()},n)}function dc(){mParticle.Store.webviewBridgeEnabled||(mParticle.Store.sessionId||si(),pf(),gi());gc()}function pf(){clearTimeout(mParticle.Store.globalTimer)}function gc(){if(!mParticle.Store.webviewBridgeEnabled){var n=r.getCookie()||r.getLocalStorage();!mParticle.Store.sessionId&&n&&(n.sid?mParticle.Store.sessionId=n.sid:si())}}function nl(n){var i={};for(var t in u.DefaultConfig)u.DefaultConfig.hasOwnProperty(t)&&(i[t]=u.DefaultConfig[t]);if(n)for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);for(t in u.DefaultUrls)i[t]=u.DefaultUrls[t];return i}function bf(t,i){var e={isEnabled:!0,sessionAttributes:{},currentSessionMPIDs:[],consentState:null,sessionId:null,isFirstRun:null,clientId:null,deviceId:null,devToken:null,migrationData:{},serverSettings:{},dateLastEventSent:null,sessionStartDate:null,currentPosition:null,isTracking:!1,watchPositionId:null,cartProducts:[],eventQueue:[],currencyCode:null,globalTimer:null,context:"",configurationLoaded:!1,identityCallInFlight:!1,SDKConfig:{},migratingToIDSyncCookies:!1,nonCurrentUserMPIDs:{},identifyCalled:!1,isLoggedIn:!1,cookieSyncDates:{},integrationAttributes:{},requireDelay:!0,isLocalStorageAvailable:null,storageName:null,prodStorageName:null,activeForwarders:[],kits:{},configuredForwarders:[],pixelConfigurations:[]},r,f;for(r in e)this[r]=e[r];this.storageName=n.createMainStorageName(t.workspaceToken);this.prodStorageName=n.createProductStorageName(t.workspaceToken);this.integrationDelayTimeoutStart=Date.now();this.SDKConfig=nl(t);t&&(this.SDKConfig.isDevelopmentMode=t.hasOwnProperty("isDevelopmentMode")?n.returnConvertedBoolean(t.isDevelopmentMode):!1,t.hasOwnProperty("serviceUrl")&&(this.SDKConfig.serviceUrl=t.serviceUrl),t.hasOwnProperty("secureServiceUrl")&&(this.SDKConfig.secureServiceUrl=t.secureServiceUrl),t.hasOwnProperty("v2ServiceUrl")&&(this.SDKConfig.v2ServiceUrl=t.v2ServiceUrl),t.hasOwnProperty("v2SecureServiceUrl")&&(this.SDKConfig.v2SecureServiceUrl=t.v2SecureServiceUrl),t.hasOwnProperty("identityUrl")&&(this.SDKConfig.identityUrl=t.identityUrl),t.hasOwnProperty("aliasUrl")&&(this.SDKConfig.aliasUrl=t.aliasUrl),t.hasOwnProperty("configUrl")&&(this.SDKConfig.configUrl=t.configUrl),t.hasOwnProperty("logLevel")&&(this.SDKConfig.logLevel=t.logLevel),this.SDKConfig.useNativeSdk=t.hasOwnProperty("useNativeSdk")?t.useNativeSdk:!1,t.hasOwnProperty("kits")&&(this.SDKConfig.kits=t.kits),this.SDKConfig.isIOS=t.hasOwnProperty("isIOS")?t.isIOS:mParticle.isIOS||!1,this.SDKConfig.useCookieStorage=t.hasOwnProperty("useCookieStorage")?t.useCookieStorage:!1,this.SDKConfig.maxProducts=t.hasOwnProperty("maxProducts")?t.maxProducts:u.DefaultConfig.maxProducts,this.SDKConfig.maxCookieSize=t.hasOwnProperty("maxCookieSize")?t.maxCookieSize:u.DefaultConfig.maxCookieSize,t.hasOwnProperty("appName")&&(this.SDKConfig.appName=t.appName),this.SDKConfig.integrationDelayTimeout=t.hasOwnProperty("integrationDelayTimeout")?t.integrationDelayTimeout:u.DefaultConfig.integrationDelayTimeout,t.hasOwnProperty("identifyRequest")&&(this.SDKConfig.identifyRequest=t.identifyRequest),t.hasOwnProperty("identityCallback")&&(f=t.identityCallback,wf.isFunction(f)?this.SDKConfig.identityCallback=t.identityCallback:i.warning("The optional callback must be a function. You tried entering a(n) "+typeof f," . Callback not set. Please set your callback again.")),t.hasOwnProperty("appVersion")&&(this.SDKConfig.appVersion=t.appVersion),t.hasOwnProperty("sessionTimeout")&&(this.SDKConfig.sessionTimeout=t.sessionTimeout),this.SDKConfig.forceHttps=t.hasOwnProperty("forceHttps")?t.forceHttps:!0,t.hasOwnProperty("customFlags")&&(this.SDKConfig.customFlags=t.customFlags),t.hasOwnProperty("workspaceToken")?this.SDKConfig.workspaceToken=t.workspaceToken:i.warning("You should have a workspaceToken on your mParticle.config object for security purposes."),t.hasOwnProperty("requiredWebviewBridgeName")?this.SDKConfig.requiredWebviewBridgeName=t.requiredWebviewBridgeName:t.hasOwnProperty("workspaceToken")&&(this.SDKConfig.requiredWebviewBridgeName=t.workspaceToken),this.SDKConfig.minWebviewBridgeVersion=t.hasOwnProperty("minWebviewBridgeVersion")?t.minWebviewBridgeVersion:1,this.SDKConfig.aliasMaxWindow=t.hasOwnProperty("aliasMaxWindow")?t.aliasMaxWindow:u.DefaultConfig.aliasMaxWindow)}function tl(n){var t=n.logLevel||"warning";this.logger=n.hasOwnProperty("logger")?n.logger:new il;this.verbose=function(n){t!=="none"&&this.logger.verbose&&t==="verbose"&&this.logger.verbose(n)};this.warning=function(n){t!=="none"&&this.logger.warning&&(t==="verbose"||t==="warning")&&this.logger.warning(n)};this.error=function(n){t!=="none"&&this.logger.error&&this.logger.error(n)};this.setLogLevel=function(n){t=n}}function il(){this.verbose=function(n){window.console&&window.console.info&&window.console.info(n)};this.error=function(n){window.console&&window.console.error&&window.console.error(n)};this.warning=function(n){window.console&&window.console.warn&&window.console.warn(n)}}function fl(){try{el()}catch(n){r.expireCookies(p.cookieNameV3);r.expireCookies(p.cookieNameV4);mParticle.Logger.error("Error migrating cookie: "+n)}if(mParticle.Store.isLocalStorageAvailable)try{sl()}catch(n){localStorage.removeItem(p.localStorageNameV3);localStorage.removeItem(p.localStorageNameV4);mParticle.Logger.error("Error migrating localStorage: "+n)}}function el(){var o=window.document.cookie.split("; "),r,t,s,f,i,e;for(mParticle.Logger.verbose(u.Messages.InformationMessages.CookieSearch),t=0,s=o.length;t<s;t++){if(f=o[t].split("="),i=n.decoded(f.shift()),e=n.decoded(f.join("=")),r,i===mParticle.Store.storageName)return;if(i===p.cookieNameV4){kf(e,p.cookieNameV4);mParticle.Store.isLocalStorageAvailable&&df();return}if(i===p.cookieNameV3){r=pr(e);kf(r,p.cookieNameV3);break}}}function kf(n,t){var o=new Date,i=r.getCookieDomain(),f,e;f=new Date(o.getTime()+p.CookieExpiration*864e5).toGMTString();e=i===""?"":";domain="+i;mParticle.Logger.verbose(u.Messages.InformationMessages.CookieSet);window.document.cookie=encodeURIComponent(mParticle.Store.storageName)+"="+n+";expires="+f+";path=/"+e;r.expireCookies(t);mParticle.Store.migratingToIDSyncCookies=!0}function pr(n){n=r.replacePipesWithCommas(r.replaceApostrophesWithQuotes(n));var t=JSON.parse(n),i=JSON.parse(ol(n));return t.mpid&&(i.gs.csm.push(t.mpid),i.gs.csm=yr.encode(JSON.stringify(i.gs.csm)),gf(t,t.mpid)),JSON.stringify(i)}function ol(n){var i,t;try{i={gs:{csm:[]}};n=JSON.parse(n);for(t in n)n.hasOwnProperty(t)&&(rl[t]?i.gs[t]=n[t]:t==="mpid"?i.cu=n[t]:n.mpid&&(i[n.mpid]=i[n.mpid]||{},ul[t]&&(i[n.mpid][t]=n[t])));return JSON.stringify(i)}catch(r){mParticle.Logger.error("Failed to restructure previous cookie into most current cookie schema")}}function df(){var n=p.localStorageProductsV4,t=localStorage.getItem(p.localStorageProductsV4);localStorage.setItem(mParticle.Store.prodStorageName,t);localStorage.removeItem(n)}function gf(n,t){if(mParticle.Store.isLocalStorageAvailable){var i={};if(i[t]={},n.cp){try{i[t].cp=JSON.parse(yr.decode(n.cp))}catch(r){i[t].cp=n.cp}Array.isArray(i[t].cp)||(i[t].cp=[])}localStorage.setItem(mParticle.Store.prodStorageName,yr.encode(JSON.stringify(i)))}}function sl(){function o(n,t){try{window.localStorage.setItem(encodeURIComponent(mParticle.Store.storageName),n)}catch(i){mParticle.Logger.error("Error with setting localStorage item.")}window.localStorage.removeItem(encodeURIComponent(t))}var t,u=p.localStorageNameV3,f=p.localStorageNameV4,s=window.localStorage.getItem(mParticle.Store.storageName),i,n,e;if(!s){if(i=window.localStorage.getItem(f),i){o(i,f);df();return}if(n=window.localStorage.getItem(u),n){if(mParticle.Store.migratingToIDSyncCookies=!0,e=n.slice(),n=JSON.parse(r.replacePipesWithCommas(r.replaceApostrophesWithQuotes(n))),n.mpid){n=JSON.parse(pr(e));o(JSON.stringify(n),u);return}if((n.cp||n.pb)&&!n.mpid){if(t=r.getCookie(),t){gf(n,t.cu);localStorage.removeItem(p.localStorageNameV3);return}localStorage.removeItem(p.localStorageNameV3);return}}}}function hl(){mParticle._forwardingStatsTimer=setInterval(function(){cl()},mParticle.Store.SDKConfig.forwarderStatsTimeout)}function cl(){var i=c.getForwarderStatsQueue(),t=r.forwardingStatsBatches.uploadsTable,f=Date.now(),u;i.length&&(t[f]={uploading:!1,data:i},c.setForwarderStatsQueue([]));for(u in t)(function(i){if(t.hasOwnProperty(i)&&t[i].uploading===!1){var u=function(){r.readyState===4&&(r.status===200||r.status===202?(mParticle.Logger.verbose("Successfully sent  "+r.statusText+" from server"),delete t[i]):r.status.toString()[0]==="4"?r.status!==429&&delete t[i]:t[i].uploading=!1)},r=n.createXHR(u),f=t[i].data;t[i].uploading=!0;ot.sendBatchForwardingStatsToServer(f,r)}})(u)}function te(t,r){var f,s,e,o;if(i.Store.configurationLoaded=!0,i.Store.webviewBridgeEnabled)a.sendToNative(u.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:"$src_env",value:"webview"})),t&&a.sendToNative(u.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:"$src_key",value:t}));else{if(n.isObject(i.Store.SDKConfig.identifyRequest)&&n.isObject(i.Store.SDKConfig.identifyRequest.userIdentities)&&Object.keys(i.Store.SDKConfig.identifyRequest.userIdentities).length===0||!i.Store.SDKConfig.identifyRequest){if(s={},f=i.Identity.getCurrentUser(),f){e=f.getUserIdentities().userIdentities||{};for(o in e)e.hasOwnProperty(o)&&(s[o]=e[o])}i.Store.SDKConfig.identifyRequest={userIdentities:s}}i.Store.migratingToIDSyncCookies&&(wr.identify(i.Store.SDKConfig.identifyRequest,i.Store.SDKConfig.identityCallback),i.Store.migratingToIDSyncCookies=!1);f=wr.getCurrentUser();n.hasFeatureFlag(u.Features.Batching)&&hl();c.processForwarders(r);!i.Store.identifyCalled&&i.Store.SDKConfig.identityCallback&&f&&f.getMPID()&&i.Store.SDKConfig.identityCallback({httpCode:vl.activeSession,getUser:function(){return al(f.getMPID())},getPreviousUser:function(){var t=i.Identity.getUsers(),n=t.shift();return n&&f&&n.getMPID()===f.getMPID()&&(n=t.shift()),n||null},body:{mpid:f.getMPID(),is_logged_in:i.Store.isLoggedIn,matched_identities:f.getUserIdentities().userIdentities,context:null,is_ephemeral:!1}});i.sessionManager.initialize();l.logAST()}i.preInit.readyQueue&&i.preInit.readyQueue.length&&(i.preInit.readyQueue.forEach(function(n){ni.isFunction(n)?n():Array.isArray(n)&&pl(n)}),i.preInit.readyQueue=[]);i.Store.isInitialized=!0;i.Store.isFirstRun&&(i.Store.isFirstRun=!1)}function yl(n,t){i.Logger=new tl(t);i.Store=new bf(t,i.Logger);i.Store.devToken=n||null;i.Logger.verbose(gt.InformationMessages.StartingInitialization);i.Store.isLocalStorageAvailable=r.determineLocalStorageAvailability(window.localStorage);i.Store.webviewBridgeEnabled=a.isWebviewEnabled(i.Store.SDKConfig.requiredWebviewBridgeName,i.Store.SDKConfig.minWebviewBridgeVersion);i.Store.webviewBridgeEnabled||(ne.migrate(),r.initializeStorage())}function pl(n){var s,t=n,e=t.splice(0,1)[0],f,r,u,o;if(i[t[0]])i[e].apply(this,t);else{f=e.split(".");try{for(r=i,u=0;u<f.length;u++)o=f[u],r=r[o];r.apply(s,t)}catch(h){i.Logger.verbose("Unable to compute proper mParticle function "+h)}}}var d={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(n){try{if(window.btoa&&window.atob)return window.btoa(unescape(encodeURIComponent(n)))}catch(t){window.console.log("Error encoding cookie values into Base64:"+t)}return this._encode(n)},_encode:function(n){var f="",e,t,i,s,h,o,r,u=0;for(n=kr.encode(n);u<n.length;)e=n.charCodeAt(u++),t=n.charCodeAt(u++),i=n.charCodeAt(u++),s=e>>2,h=(e&3)<<4|t>>4,o=(t&15)<<2|i>>6,r=i&63,isNaN(t)?o=r=64:isNaN(i)&&(r=64),f=f+d._keyStr.charAt(s)+d._keyStr.charAt(h)+d._keyStr.charAt(o)+d._keyStr.charAt(r);return f},decode:function(n){try{if(window.btoa&&window.atob)return decodeURIComponent(escape(window.atob(n)))}catch(t){}return d._decode(n)},_decode:function(n){var t="",e,o,s,h,u,r,f,i=0;for(n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<n.length;)h=d._keyStr.indexOf(n.charAt(i++)),u=d._keyStr.indexOf(n.charAt(i++)),r=d._keyStr.indexOf(n.charAt(i++)),f=d._keyStr.indexOf(n.charAt(i++)),e=h<<2|u>>4,o=(u&15)<<4|r>>2,s=(r&3)<<6|f,t=t+String.fromCharCode(e),r!==64&&(t=t+String.fromCharCode(o)),f!==64&&(t=t+String.fromCharCode(s));return kr.decode(t)}},kr={encode:function(n){for(var t,i="",r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i},decode:function(n){for(var r="",t=0,i=0,u=0,f=0;t<n.length;)i=n.charCodeAt(t),i<128?(r+=String.fromCharCode(i),t++):i>191&&i<224?(u=n.charCodeAt(t+1),r+=String.fromCharCode((i&31)<<6|u&63),t+=2):(u=n.charCodeAt(t+1),f=n.charCodeAt(t+2),r+=String.fromCharCode((i&15)<<12|(u&63)<<6|f&63),t+=3);return r}},vt={forEach:function(n,t){var u,i,r,f,e;if(this==null)throw new TypeError(" this is null or not defined");if(r=Object(this),f=r.length>>>0,typeof n!="function")throw new TypeError(n+" is not a function");for(arguments.length>1&&(u=t),i=0;i<f;)i in r&&(e=r[i],n.call(u,e,i,r)),i++},map:function(n,t){var e,u,i,r,f,o,s;if(this===null)throw new TypeError(" this is null or not defined");if(r=Object(this),f=r.length>>>0,typeof n!="function")throw new TypeError(n+" is not a function");for(arguments.length>1&&(e=t),u=new Array(f),i=0;i<f;)i in r&&(o=r[i],s=n.call(e,o,i,r),u[i]=s),i++;return u},filter:function(n){var i,f,r,e,t,u;if(this===void 0||this===null)throw new TypeError;if(i=Object(this),f=i.length>>>0,typeof n!="function")throw new TypeError;for(r=[],e=arguments.length>=2?arguments[1]:void 0,t=0;t<f;t++)t in i&&(u=i[t],n.call(e,u,t,i)&&r.push(u));return r},isArray:function(n){return Object.prototype.toString.call(n)==="[object Array]"},Base64:d},nt={Unknown:0,Navigation:1,Location:2,Search:3,Transaction:4,UserContent:5,UserPreference:6,Social:7,Other:8,getName:function(n){switch(n){case nt.Navigation:return"Navigation";case nt.Location:return"Location";case nt.Search:return"Search";case nt.Transaction:return"Transaction";case nt.UserContent:return"User Content";case nt.UserPreference:return"User Preference";case nt.Social:return"Social";case w.ProductAddToCart:return"Product Added to Cart";case w.ProductAddToWishlist:return"Product Added to Wishlist";case w.ProductCheckout:return"Product Checkout";case w.ProductCheckoutOption:return"Product Checkout Options";case w.ProductClick:return"Product Click";case w.ProductImpression:return"Product Impression";case w.ProductPurchase:return"Product Purchased";case w.ProductRefund:return"Product Refunded";case w.ProductRemoveFromCart:return"Product Removed From Cart";case w.ProductRemoveFromWishlist:return"Product Removed from Wishlist";case w.ProductViewDetail:return"Product View Details";case w.PromotionClick:return"Promotion Click";case w.PromotionView:return"Promotion View";default:return"Other"}}},w={ProductAddToCart:10,ProductRemoveFromCart:11,ProductCheckout:12,ProductCheckoutOption:13,ProductClick:14,ProductViewDetail:15,ProductPurchase:16,ProductRefund:17,PromotionView:18,PromotionClick:19,ProductAddToWishlist:20,ProductRemoveFromWishlist:21,ProductImpression:22},f={Other:0,CustomerId:1,Facebook:2,Twitter:3,Google:4,Microsoft:5,Yahoo:6,Email:7,FacebookCustomAudienceId:9,Other2:10,Other3:11,Other4:12},o,tt,ht,a,fu,g,vi,et,ot,v,at,e,wf,ne,i;f.isValid=function(n){if(typeof n=="number")for(var t in f)if(f.hasOwnProperty(t)&&f[t]===n)return!0;return!1};f.getName=function(n){switch(n){case window.mParticle.IdentityType.CustomerId:return"Customer ID";case window.mParticle.IdentityType.Facebook:return"Facebook ID";case window.mParticle.IdentityType.Twitter:return"Twitter ID";case window.mParticle.IdentityType.Google:return"Google ID";case window.mParticle.IdentityType.Microsoft:return"Microsoft ID";case window.mParticle.IdentityType.Yahoo:return"Yahoo ID";case window.mParticle.IdentityType.Email:return"Email";case window.mParticle.IdentityType.FacebookCustomAudienceId:return"Facebook App User ID";default:return"Other ID"}};f.getIdentityType=function(n){switch(n){case"other":return f.Other;case"customerid":return f.CustomerId;case"facebook":return f.Facebook;case"twitter":return f.Twitter;case"google":return f.Google;case"microsoft":return f.Microsoft;case"yahoo":return f.Yahoo;case"email":return f.Email;case"facebookcustomaudienceid":return f.FacebookCustomAudienceId;case"other1":return f.Other1;case"other2":return f.Other2;case"other3":return f.Other3;case"other4":return f.Other4;default:return!1}};f.getIdentityName=function(n){switch(n){case f.Other:return"other";case f.CustomerId:return"customerid";case f.Facebook:return"facebook";case f.Twitter:return"twitter";case f.Google:return"google";case f.Microsoft:return"microsoft";case f.Yahoo:return"yahoo";case f.Email:return"email";case f.FacebookCustomAudienceId:return"facebookcustomaudienceid";case f.Other1:return"other1";case f.Other2:return"other2";case f.Other3:return"other3";case f.Other4:return"other4"}};o={Unknown:0,AddToCart:1,RemoveFromCart:2,Checkout:3,CheckoutOption:4,Click:5,ViewDetail:6,Purchase:7,Refund:8,AddToWishlist:9,RemoveFromWishlist:10};o.getName=function(n){switch(n){case o.AddToCart:return"Add to Cart";case o.RemoveFromCart:return"Remove from Cart";case o.Checkout:return"Checkout";case o.CheckoutOption:return"Checkout Option";case o.Click:return"Click";case o.ViewDetail:return"View Detail";case o.Purchase:return"Purchase";case o.Refund:return"Refund";case o.AddToWishlist:return"Add to Wishlist";case o.RemoveFromWishlist:return"Remove from Wishlist";default:return"Unknown"}};o.getExpansionName=function(n){switch(n){case o.AddToCart:return"add_to_cart";case o.RemoveFromCart:return"remove_from_cart";case o.Checkout:return"checkout";case o.CheckoutOption:return"checkout_option";case o.Click:return"click";case o.ViewDetail:return"view_detail";case o.Purchase:return"purchase";case o.Refund:return"refund";case o.AddToWishlist:return"add_to_wishlist";case o.RemoveFromWishlist:return"remove_from_wishlist";default:return"unknown"}};tt={Unknown:0,PromotionView:1,PromotionClick:2};tt.getName=function(n){switch(n){case tt.PromotionView:return"view";case tt.PromotionClick:return"click";default:return"unknown"}};tt.getExpansionName=function(n){switch(n){case tt.PromotionView:return"view";case tt.PromotionClick:return"click";default:return"unknown"}};var t={MessageType:{SessionStart:1,SessionEnd:2,PageView:3,PageEvent:4,CrashReport:5,OptOut:6,AppStateTransition:10,Profile:14,Commerce:16},EventType:nt,CommerceEventType:w,IdentityType:f,ProfileMessageType:{Logout:3},ApplicationTransitionType:{AppInit:1},ProductActionType:o,PromotionActionType:tt},u={sdkVersion:"2.9.10",sdkVendor:"mparticle",platform:"web",Messages:{ErrorMessages:{NoToken:"A token must be specified.",EventNameInvalidType:"Event name must be a valid string value.",EventDataInvalidType:"Event data must be a valid object hash.",LoggingDisabled:"Event logging is currently disabled.",CookieParseError:"Could not parse cookie",EventEmpty:"Event object is null or undefined, cancelling send",APIRequestEmpty:"APIRequest is null or undefined, cancelling send",NoEventType:"Event type must be specified.",TransactionIdRequired:"Transaction ID is required",TransactionRequired:"A transaction attributes object is required",PromotionIdRequired:"Promotion ID is required",BadAttribute:"Attribute value cannot be object or array",BadKey:"Key value cannot be object or array",BadLogPurchase:"Transaction attributes and a product are both required to log a purchase, https://docs.mparticle.com/?javascript#measuring-transactions"},InformationMessages:{CookieSearch:"Searching for cookie",CookieFound:"Cookie found, parsing values",CookieNotFound:"Cookies not found",CookieSet:"Setting cookie",CookieSync:"Performing cookie sync",SendBegin:"Starting to send event",SendIdentityBegin:"Starting to send event to identity server",SendWindowsPhone:"Sending event to Windows Phone container",SendIOS:"Calling iOS path: ",SendAndroid:"Calling Android JS interface method: ",SendHttp:"Sending event to mParticle HTTP service",SendAliasHttp:"Sending alias request to mParticle HTTP service",SendIdentityHttp:"Sending event to mParticle HTTP service",StartingNewSession:"Starting new Session",StartingLogEvent:"Starting to log event",StartingLogOptOut:"Starting to log user opt in/out",StartingEndSession:"Starting to end session",StartingInitialization:"Starting to initialize",StartingLogCommerceEvent:"Starting to log commerce event",StartingAliasRequest:"Starting to Alias MPIDs",LoadingConfig:"Loading configuration options",AbandonLogEvent:"Cannot log event, logging disabled or developer token not set",AbandonAliasUsers:"Cannot Alias Users, logging disabled or developer token not set",AbandonStartSession:"Cannot start session, logging disabled or developer token not set",AbandonEndSession:"Cannot end session, logging disabled or developer token not set",NoSessionToEnd:"Cannot end session, no active session found"},ValidationMessages:{ModifyIdentityRequestUserIdentitiesPresent:"identityRequests to modify require userIdentities to be present. Request not sent to server. Please fix and try again",IdentityRequesetInvalidKey:"There is an invalid key on your identityRequest object. It can only contain a `userIdentities` object and a `onUserAlias` function. Request not sent to server. Please fix and try again.",OnUserAliasType:"The onUserAlias value must be a function. The onUserAlias provided is of type",UserIdentities:"The userIdentities key must be an object with keys of identityTypes and values of strings. Request not sent to server. Please fix and try again.",UserIdentitiesInvalidKey:"There is an invalid identity key on your `userIdentities` object within the identityRequest. Request not sent to server. Please fix and try again.",UserIdentitiesInvalidValues:"All user identity values must be strings or null. Request not sent to server. Please fix and try again.",AliasMissingMpid:"Alias Request must contain both a destinationMpid and a sourceMpid",AliasNonUniqueMpid:"Alias Request's destinationMpid and sourceMpid must be unique",AliasMissingTime:"Alias Request must have both a startTime and an endTime",AliasStartBeforeEndTime:"Alias Request's endTime must be later than its startTime"}},NativeSdkPaths:{LogEvent:"logEvent",SetUserTag:"setUserTag",RemoveUserTag:"removeUserTag",SetUserAttribute:"setUserAttribute",RemoveUserAttribute:"removeUserAttribute",SetSessionAttribute:"setSessionAttribute",AddToCart:"addToCart",RemoveFromCart:"removeFromCart",ClearCart:"clearCart",LogOut:"logOut",SetUserAttributeList:"setUserAttributeList",RemoveAllUserAttributes:"removeAllUserAttributes",GetUserAttributesLists:"getUserAttributesLists",GetAllUserAttributes:"getAllUserAttributes",Identify:"identify",Logout:"logout",Login:"login",Modify:"modify",Alias:"aliasUsers"},StorageNames:{localStorageName:"mprtcl-api",localStorageNameV3:"mprtcl-v3",cookieName:"mprtcl-api",cookieNameV2:"mprtcl-v2",cookieNameV3:"mprtcl-v3",localStorageNameV4:"mprtcl-v4",localStorageProductsV4:"mprtcl-prodv4",cookieNameV4:"mprtcl-v4",currentStorageName:"mprtcl-v4",currentStorageProductsName:"mprtcl-prodv4"},DefaultConfig:{cookieDomain:null,cookieExpiration:365,logLevel:null,timeout:300,sessionTimeout:30,maxProducts:20,forwarderStatsTimeout:5e3,integrationDelayTimeout:5e3,maxCookieSize:3e3,aliasMaxWindow:90},DefaultUrls:{v1SecureServiceUrl:"jssdks.mparticle.com/v1/JS/",v2SecureServiceUrl:"jssdks.mparticle.com/v2/JS/",configUrl:"jssdkcdns.mparticle.com/JS/v2/",identityUrl:"identity.mparticle.com/v1/",aliasUrl:"jssdks.mparticle.com/v1/identity/"},Base64CookieKeys:{csm:1,sa:1,ss:1,ua:1,ui:1,csd:1,ia:1,con:1},SDKv2NonMPIDCookieKeys:{gs:1,cu:1,l:1,globalSettings:1,currentUserMPID:1},HTTPCodes:{noHttpCoverage:-1,activeIdentityRequest:-2,activeSession:-3,validationIssue:-4,nativeIdentityRequest:-5,loggingDisabledOrMissingAPIKey:-6,tooManyRequests:429},Features:{Batching:"batching"}},hi=u.StorageNames,ie=/\+/g;ht={isValidAttributeValue:function(n){return n!==undefined&&!it(n)&&!Array.isArray(n)},isValidKeyValue:function(n){return Boolean(n&&!it(n)&&!Array.isArray(n))},isStringOrNumber:function(n){return typeof n=="string"||typeof n=="number"},isFunction:function(n){return typeof n=="function"},validateIdentities:function(n,i){var e={userIdentities:1,onUserAlias:1,copyUserAttributes:1},r,f;if(n){if(i==="modify"&&(it(n.userIdentities)&&!Object.keys(n.userIdentities).length||!it(n.userIdentities)))return{valid:!1,error:u.Messages.ValidationMessages.ModifyIdentityRequestUserIdentitiesPresent};for(r in n)if(n.hasOwnProperty(r)){if(!e[r])return{valid:!1,error:u.Messages.ValidationMessages.IdentityRequesetInvalidKey};if(r==="onUserAlias"&&!ht.isFunction(n[r]))return{valid:!1,error:u.Messages.ValidationMessages.OnUserAliasType+typeof n[r]}}if(Object.keys(n).length===0)return{valid:!0};if(n.userIdentities===undefined)return{valid:!1,error:u.Messages.ValidationMessages.UserIdentities};if(n.userIdentities!==null&&!it(n.userIdentities))return{valid:!1,error:u.Messages.ValidationMessages.UserIdentities};if(it(n.userIdentities)&&Object.keys(n.userIdentities).length)for(f in n.userIdentities)if(n.userIdentities.hasOwnProperty(f)){if(t.IdentityType.getIdentityType(f)===!1)return{valid:!1,error:u.Messages.ValidationMessages.UserIdentitiesInvalidKey};if(!(typeof n.userIdentities[f]=="string"||n.userIdentities[f]===null))return{valid:!1,error:u.Messages.ValidationMessages.UserIdentitiesInvalidValues}}}return{valid:!0}}};var n={canLog:re,extend:dr,isObject:it,inArray:ci,createServiceUrl:se,createXHR:he,generateUniqueId:gr,filterUserIdentities:le,filterUserIdentitiesForForwarders:ae,filterUserAttributes:ve,findKeyInObject:ye,decoded:pe,converted:we,isEventType:be,parseNumber:ke,parseStringOrNumber:de,generateHash:nu,sanitizeAttributes:ge,returnConvertedBoolean:ue,invokeCallback:ee,invokeAliasCallback:oe,hasFeatureFlag:fe,isDelayedByIntegration:no,processQueuedEvents:to,createMainStorageName:io,createProductStorageName:ro,Validators:ht},ti=u.Messages,tu="mParticleAndroid",nr="mParticle";a={isWebviewEnabled:uo,isBridgeV2Available:iu,sendToNative:eo};fu={toMinifiedJsonObject:function(n){var r={},u,i,t;if(n&&(u=n.getGDPRConsentState(),u)){r.gdpr={};for(i in u)u.hasOwnProperty(i)&&(t=u[i],r.gdpr[i]={},typeof t.Consented=="boolean"&&(r.gdpr[i].c=t.Consented),typeof t.Timestamp=="number"&&(r.gdpr[i].ts=t.Timestamp),typeof t.ConsentDocument=="string"&&(r.gdpr[i].d=t.ConsentDocument),typeof t.Location=="string"&&(r.gdpr[i].l=t.Location),typeof t.HardwareId=="string"&&(r.gdpr[i].h=t.HardwareId))}return r},fromMinifiedJsonObject:function(n){var i=eu(),t,r;if(n.gdpr)for(t in n.gdpr)n.gdpr.hasOwnProperty(t)&&(r=tr(n.gdpr[t].c,n.gdpr[t].ts,n.gdpr[t].d,n.gdpr[t].l,n.gdpr[t].h),i.addGDPRConsentState(t,r));return i}};var ii={createGDPRConsent:tr,Serialization:fu,createConsentState:eu},k=vt.Base64,yt=u.Messages,li=u.Base64CookieKeys,ri=u.SDKv2NonMPIDCookieKeys,rt=u.StorageNames;var r={useLocalStorage:ou,initializeStorage:so,update:su,determineLocalStorageAvailability:co,getUserProductsFromLS:lo,getAllUserProductsFromLS:hu,setLocalStorage:cu,getLocalStorage:ui,storeDataInMemory:pt,retrieveDeviceId:ao,parseDeviceId:au,expireCookies:ut,getCookie:fi,setCookie:vu,reduceAndEncodeCookies:ir,findPrevCookiesBasedOnUI:vo,replaceCommasWithPipes:yu,replacePipesWithCommas:pu,replaceApostrophesWithQuotes:wu,replaceQuotesWithApostrophes:bu,createCookieString:ku,revertCookieString:du,decodeCookies:fr,getCookieDomain:ai,getUserIdentities:po,getAllUserAttributes:wo,getCartProducts:bo,setCartProducts:ko,saveCookies:lt,saveUserIdentitiesToCookies:go,saveUserAttributesToCookies:ns,saveUserCookieSyncDatesToCookies:ts,saveUserConsentStateToCookies:is,getPersistence:b,getDeviceId:ss,resetPersistence:hs,getConsentState:rs,forwardingStatsBatches:{uploadsTable:{},forwardingStatsEventQueue:[]},getFirstSeenTime:us,getLastSeenTime:es,setFirstSeenTime:fs,setLastSeenTime:os},cs=u.Messages,wt={attemptCookieSync:function(n,t){var i,f,e,o,u;t&&!mParticle.Store.webviewBridgeEnabled&&mParticle.Store.pixelConfigurations.forEach(function(s){i={moduleId:s.moduleId,frequencyCap:s.frequencyCap,pixelUrl:wt.replaceAmp(s.pixelUrl),redirectUrl:s.redirectUrl?wt.replaceAmp(s.redirectUrl):null};e=wt.replaceMPID(i.pixelUrl,t);o=i.redirectUrl?wt.replaceMPID(i.redirectUrl,t):"";u=e+encodeURIComponent(o);var h=r.getPersistence();if(n&&n!==t){h&&h[t]&&(h[t].csd||(h[t].csd={}),er(u,i.moduleId,t,h[t].csd));return}h[t]&&(h[t].csd||(h[t].csd={}),f=h[t].csd[i.moduleId.toString()]?h[t].csd[i.moduleId.toString()]:null,f?(new Date).getTime()>new Date(f).getTime()+i.frequencyCap*864e5&&er(u,i.moduleId,t,h[t].csd):er(u,i.moduleId,t,h[t].csd))})},replaceMPID:function(n,t){return n.replace("%%mpid%%",t)},replaceAmp:function(n){return n.replace(/&amp;/g,"&")}};var or=t.MessageType,ls=t.ApplicationTransitionType,ft=n.parseNumber;g={createEventObject:ys,convertEventToDTO:ps,convertToConsentStateDTO:gu};vi=u.HTTPCodes;et=u.Messages;ot={sendEventToServer:tf,sendIdentityRequest:bs,sendBatchForwardingStatsToServer:ks,sendSingleForwardingStatsToServer:ds,sendAliasRequest:ws,getSDKConfiguration:gs};var c={initForwarders:rf,applyToForwarders:th,sendEventToForwarders:ih,callSetUserAttributeOnForwarders:rh,setForwarderUserIdentities:uh,setForwarderOnUserIdentified:fh,setForwarderOnIdentityComplete:eh,getForwarderStatsQueue:ef,setForwarderStatsQueue:of,isEnabledForUserConsent:uf,isEnabledForUserAttributes:ff,configurePixel:sf,processForwarders:hh},yi=n.Validators,pi=u.Messages;var s={convertTransactionAttributesToProductAction:ch,getProductActionEventName:lh,getPromotionActionEventName:ah,convertProductActionToEventType:vh,convertPromotionActionToEventType:yh,buildProductList:wh,createProduct:bh,createPromotion:kh,createImpression:dh,createTransactionAttributes:gh,expandCommerceEvent:tc,createCommerceEventObject:uc},bt=u.Messages,hr=ot.sendEventToServer,cr=c.sendEventToForwarders;var l={logEvent:lr,startTracking:fc,stopTracking:ec,logCheckoutEvent:hc,logProductActionEvent:cc,logPurchaseEvent:lc,logRefundEvent:ac,logPromotionEvent:vc,logImpressionEvent:yc,logOptOut:oc,logAST:sc,parseEventResponse:bi,addEventHandler:pc},h=u.Messages,st=n.Validators,y=u.HTTPCodes,wc=c.sendEventToForwarders,ki=ot.sendIdentityRequest;v={createKnownIdentities:function(t,i){var r={},u;if(t&&t.userIdentities&&n.isObject(t.userIdentities))for(u in t.userIdentities)r[u]=t.userIdentities[u];return r.device_application_stamp=i,r},preProcessIdentityRequest:function(n,t,i){var r,u;return(mParticle.Logger.verbose(h.InformationMessages.StartingLogEvent+": "+i),r=st.validateIdentities(n,i),!r.valid)?(mParticle.Logger.error("ERROR: "+r.error),{valid:!1,error:r.error}):t&&!st.isFunction(t)?(u="The optional callback must be a function. You tried entering a(n) "+typeof t,mParticle.Logger.error(u),{valid:!1,error:u}):{valid:!0}},createIdentityRequest:function(t,i,r,u,f,e,o){return{client_sdk:{platform:i,sdk_vendor:r,sdk_version:u},context:e,environment:mParticle.Store.SDKConfig.isDevelopmentMode?"development":"production",request_id:n.generateUniqueId(),request_timestamp_ms:(new Date).getTime(),previous_mpid:o||null,known_identities:this.createKnownIdentities(t,f)}},createModifyIdentityRequest:function(t,i,r,u,f,e){return{client_sdk:{platform:r,sdk_vendor:u,sdk_version:f},context:e,environment:mParticle.Store.SDKConfig.isDevelopmentMode?"development":"production",request_id:n.generateUniqueId(),request_timestamp_ms:(new Date).getTime(),identity_changes:this.createIdentityChanges(t,i)}},createIdentityChanges:function(t,i){var u=[],r;if(i&&n.isObject(i)&&t&&n.isObject(t))for(r in i)u.push({old_value:t[r]||null,new_value:i[r],identity_type:r});return u},modifyUserIdentities:function(n,i){var u={};for(var r in i)u[t.IdentityType.getIdentityType(r)]=i[r];for(r in n)u[r]||(u[r]=n[r]);return u},createAliasNetworkRequest:function(t){return{request_id:n.generateUniqueId(),request_type:"alias",environment:mParticle.Store.SDKConfig.isDevelopmentMode?"development":"production",api_key:mParticle.Store.devToken,data:{destination_mpid:t.destinationMpid,source_mpid:t.sourceMpid,start_unixtime_ms:t.startTime,end_unixtime_ms:t.endTime,device_application_stamp:mParticle.Store.deviceId}}},convertAliasToNative:function(n){return{DestinationMpid:n.destinationMpid,SourceMpid:n.sourceMpid,StartUnixtimeMs:n.startTime,EndUnixtimeMs:n.endTime}},convertToNative:function(n){var r=[],i;if(n&&n.userIdentities){for(i in n.userIdentities)n.userIdentities.hasOwnProperty(i)&&r.push({Type:t.IdentityType.getIdentityType(i),Identity:n.userIdentities[i]});return{UserIdentities:r}}}};at={HTTPCodes:y,identify:function(t,i){var r,e=mParticle.Identity.getCurrentUser(),f=v.preProcessIdentityRequest(t,i,"identify"),o;e&&(r=e.getMPID());f.valid?(o=v.createIdentityRequest(t,u.platform,u.sdkVendor,u.sdkVersion,mParticle.Store.deviceId,mParticle.Store.context,r),n.canLog()?mParticle.Store.webviewBridgeEnabled?(a.sendToNative(u.NativeSdkPaths.Identify,JSON.stringify(v.convertToNative(t))),n.invokeCallback(i,y.nativeIdentityRequest,"Identify request sent to native sdk")):ki(o,"identify",i,t,di,r):(n.invokeCallback(i,y.loggingDisabledOrMissingAPIKey,h.InformationMessages.AbandonLogEvent),mParticle.Logger.verbose(h.InformationMessages.AbandonLogEvent))):(n.invokeCallback(i,y.validationIssue,f.error),mParticle.Logger.verbose(f))},logout:function(i,r){var f,s=mParticle.Identity.getCurrentUser(),e=v.preProcessIdentityRequest(i,r,"logout"),o,c;s&&(f=s.getMPID());e.valid?(c=v.createIdentityRequest(i,u.platform,u.sdkVendor,u.sdkVersion,mParticle.Store.deviceId,mParticle.Store.context,f),n.canLog()?mParticle.Store.webviewBridgeEnabled?(a.sendToNative(u.NativeSdkPaths.Logout,JSON.stringify(v.convertToNative(i))),n.invokeCallback(r,y.nativeIdentityRequest,"Logout request sent to native sdk")):(ki(c,"logout",r,i,di,f),o=g.createEventObject(t.MessageType.Profile),o.ProfileMessageType=t.ProfileMessageType.Logout,mParticle.Store.activeForwarders.length&&mParticle.Store.activeForwarders.forEach(function(n){n.logOut&&n.logOut(o)})):(n.invokeCallback(r,y.loggingDisabledOrMissingAPIKey,h.InformationMessages.AbandonLogEvent),mParticle.Logger.verbose(h.InformationMessages.AbandonLogEvent))):(n.invokeCallback(r,y.validationIssue,e.error),mParticle.Logger.verbose(e))},login:function(t,i){var r,e=mParticle.Identity.getCurrentUser(),f=v.preProcessIdentityRequest(t,i,"login"),o;e&&(r=e.getMPID());f.valid?(o=v.createIdentityRequest(t,u.platform,u.sdkVendor,u.sdkVersion,mParticle.Store.deviceId,mParticle.Store.context,r),n.canLog()?mParticle.Store.webviewBridgeEnabled?(a.sendToNative(u.NativeSdkPaths.Login,JSON.stringify(v.convertToNative(t))),n.invokeCallback(i,y.nativeIdentityRequest,"Login request sent to native sdk")):ki(o,"login",i,t,di,r):(n.invokeCallback(i,y.loggingDisabledOrMissingAPIKey,h.InformationMessages.AbandonLogEvent),mParticle.Logger.verbose(h.InformationMessages.AbandonLogEvent))):(n.invokeCallback(i,y.validationIssue,f.error),mParticle.Logger.verbose(f))},modify:function(t,i){var e,r=mParticle.Identity.getCurrentUser(),f=v.preProcessIdentityRequest(t,i,"modify"),o,s;r&&(e=r.getMPID());o=t&&t.userIdentities?t.userIdentities:{};f.valid?(s=v.createModifyIdentityRequest(r?r.getUserIdentities().userIdentities:{},o,u.platform,u.sdkVendor,u.sdkVersion,mParticle.Store.context),n.canLog()?mParticle.Store.webviewBridgeEnabled?(a.sendToNative(u.NativeSdkPaths.Modify,JSON.stringify(v.convertToNative(t))),n.invokeCallback(i,y.nativeIdentityRequest,"Modify request sent to native sdk")):ki(s,"modify",i,t,di,e):(n.invokeCallback(i,y.loggingDisabledOrMissingAPIKey,h.InformationMessages.AbandonLogEvent),mParticle.Logger.verbose(h.InformationMessages.AbandonLogEvent))):(n.invokeCallback(i,y.validationIssue,f.error),mParticle.Logger.verbose(f))},getCurrentUser:function(){var n=mParticle.Store.mpid;return n?(n=mParticle.Store.mpid.slice(),ei(n,mParticle.Store.isLoggedIn)):mParticle.Store.webviewBridgeEnabled?ei():null},getUser:function(n){var t=r.getPersistence();return t?t[n]&&!u.SDKv2NonMPIDCookieKeys.hasOwnProperty(n)?ei(n):null:null},getUsers:function(){var i=r.getPersistence(),n=[],t;if(i)for(t in i)u.SDKv2NonMPIDCookieKeys.hasOwnProperty(t)||n.push(ei(t));return n.sort(function(n,t){var i=n.getLastSeenTime()||0,r=t.getLastSeenTime()||0;return i>r?-1:1}),n},aliasUsers:function(t,i){var r,f;if(t.destinationMpid&&t.sourceMpid||(r=h.ValidationMessages.AliasMissingMpid),t.destinationMpid===t.sourceMpid&&(r=h.ValidationMessages.AliasNonUniqueMpid),t.startTime&&t.endTime||(r=h.ValidationMessages.AliasMissingTime),t.startTime>t.endTime&&(r=h.ValidationMessages.AliasStartBeforeEndTime),r){mParticle.Logger.warning(r);n.invokeAliasCallback(i,y.validationIssue,r);return}n.canLog()?mParticle.Store.webviewBridgeEnabled?(a.sendToNative(u.NativeSdkPaths.Alias,JSON.stringify(v.convertAliasToNative(t))),n.invokeAliasCallback(i,y.nativeIdentityRequest,"Alias request sent to native sdk")):(mParticle.Logger.verbose(h.InformationMessages.StartingAliasRequest+": "+t.sourceMpid+" -> "+t.destinationMpid),f=v.createAliasNetworkRequest(t),ot.sendAliasRequest(f,i)):(n.invokeAliasCallback(i,y.loggingDisabledOrMissingAPIKey,h.InformationMessages.AbandonAliasUsers),mParticle.Logger.verbose(h.InformationMessages.AbandonAliasUsers))},createAliasRequest:function(n,t){var i,r,u;try{return!t||!n?(mParticle.Logger.error("'destinationUser' and 'sourceUser' must both be present"),null):(i=n.getFirstSeenTime(),i||mParticle.Identity.getUsers().forEach(function(n){n.getFirstSeenTime()&&(!i||n.getFirstSeenTime()<i)&&(i=n.getFirstSeenTime())}),r=(new Date).getTime()-mParticle.Store.SDKConfig.aliasMaxWindow*864e5,u=n.getLastSeenTime()||(new Date).getTime(),i<r&&(i=r,u<i&&mParticle.Logger.warning("Source User has not been seen in the last "+mParticle.Store.SDKConfig.maxAliasWindow+" days, Alias Request will likely fail")),{destinationMpid:t.getMPID(),sourceMpid:n.getMPID(),startTime:i,endTime:u})}catch(f){return mParticle.Logger.error("There was a problem with creating an alias request: "+f),null}}};var dt={checkIdentitySwap:af,IdentityRequest:v,IdentityAPI:at,mParticleUser:ei,mParticleUserCart:vf},yf=dt.IdentityAPI,oi=u.Messages,ar=l.logEvent;e={initialize:bc,getSession:kc,startNewSession:si,endSession:vr,setSessionTimer:gi,resetSessionTimer:dc,clearSessionTimeout:pf};wf=n.Validators;var p=u.StorageNames,yr=vt.Base64,rl={das:1},ul={ui:1};ne={migrate:fl,convertSDKv1CookiesV3ToSDKv2CookiesV4:pr};var ll=r.getDeviceId,gt=u.Messages,ni=n.Validators,al=dt.mParticleUser,wr=dt.IdentityAPI,br=dt.mParticleUserCart,vl=u.HTTPCodes;return Array.prototype.forEach||(Array.prototype.forEach=vt.forEach),Array.prototype.map||(Array.prototype.map=vt.map),Array.prototype.filter||(Array.prototype.filter=vt.filter),Array.isArray||(Array.prototype.isArray=vt.isArray),i={config:window.mParticle?window.mParticle.config:{},Store:{},getDeviceId:ll,generateHash:n.generateHash,sessionManager:e,cookieSyncManager:wt,persistence:r,isIOS:window.mParticle&&window.mParticle.isIOS?window.mParticle.isIOS:!1,Identity:wr,Validators:ni,_Identity:dt,_IdentityRequest:dt.IdentityRequest,IdentityType:t.IdentityType,EventType:t.EventType,CommerceEventType:t.CommerceEventType,PromotionType:t.PromotionActionType,ProductActionType:t.ProductActionType,init:function(n,t){if(!t&&window.mParticle.config&&(window.console.warn("You did not pass a config object to mParticle.init(). Attempting to use the window.mParticle.config if it exists. Please note that in a future release, this may not work and mParticle will not initialize properly"),t=window.mParticle.config),yl(n,t),t)!t.hasOwnProperty("requestConfig")||t.requestConfig?ot.getSDKConfiguration(n,t,te):te(n,t);else{window.console.error("No config available on the window, please pass a config object to mParticle.init()");return}},setLogLevel:function(n){i.Logger.setLogLevel(n)},reset:function(n,t){i.Store&&delete i.Store;i.Store=new bf(n);i.Store.isLocalStorageAvailable=r.determineLocalStorageAvailability(window.localStorage);l.stopTracking();t||r.resetPersistence();r.forwardingStatsBatches.uploadsTable={};r.forwardingStatsBatches.forwardingStatsEventQueue=[];i.preInit={readyQueue:[],pixelConfigurations:[],integrationDelays:{},featureFlags:{},forwarderConstructors:[],isDevelopmentMode:!1}},ready:function(n){i.Store.isInitialized&&typeof n=="function"?n():i.preInit.readyQueue.push(n)},getVersion:function(){return u.sdkVersion},setAppVersion:function(n){i.Store.SDKConfig.appVersion=n;r.update()},getAppName:function(){return i.Store.SDKConfig.appName},setAppName:function(n){i.Store.SDKConfig.appName=n},getAppVersion:function(){return i.Store.SDKConfig.appVersion},stopTrackingLocation:function(){e.resetSessionTimer();l.stopTracking()},startTrackingLocation:function(n){ni.isFunction(n)||i.Logger.warning("Warning: Location tracking is triggered, but not including a callback into the `startTrackingLocation` may result in events logged too quickly and not being associated with a location.");e.resetSessionTimer();l.startTracking(n)},setPosition:function(n,t){e.resetSessionTimer();typeof n=="number"&&typeof t=="number"?i.Store.currentPosition={lat:n,lng:t}:i.Logger.error("Position latitude and/or longitude must both be of type number")},startNewSession:function(){e.startNewSession()},endSession:function(){e.endSession(!0)},logEvent:function(r,u,f,o){if(e.resetSessionTimer(),typeof r!="string"){i.Logger.error(gt.ErrorMessages.EventNameInvalidType);return}if(u||(u=t.EventType.Unknown),!n.isEventType(u)){i.Logger.error("Invalid event type: "+u+", must be one of: \n"+JSON.stringify(t.EventType));return}if(!n.canLog()){i.Logger.error(gt.ErrorMessages.LoggingDisabled);return}l.logEvent(t.MessageType.PageEvent,r,f,u,o)},logError:function(i,r){var u,f,o;if(e.resetSessionTimer(),i){if(typeof i=="string"&&(i={message:i}),u={m:i.message?i.message:i,s:"Error",t:i.stack},r){f=n.sanitizeAttributes(r);for(o in f)u[o]=f[o]}l.logEvent(t.MessageType.CrashReport,i.name?i.name:"Error",u,t.EventType.Other)}},logLink:function(n,t,i,r){e.resetSessionTimer();l.addEventHandler("click",n,t,r,i)},logForm:function(n,t,i,r){e.resetSessionTimer();l.addEventHandler("submit",n,t,r,i)},logPageView:function(r,u,f){if(e.resetSessionTimer(),n.canLog()){if(ni.isStringOrNumber(r)||(r="PageView"),u){if(!n.isObject(u)){i.Logger.error("The attributes argument must be an object. A "+typeof u+" was entered. Please correct and retry.");return}}else u={hostname:window.location.hostname,title:window.document.title};if(f&&!n.isObject(f)){i.Logger.error("The customFlags argument must be an object. A "+typeof f+" was entered. Please correct and retry.");return}}l.logEvent(t.MessageType.PageView,r,u,t.EventType.Unknown,f)},Consent:{createGDPRConsent:ii.createGDPRConsent,createConsentState:ii.createConsentState},eCommerce:{Cart:{add:function(n,t){var r,u=i.Identity.getCurrentUser();u&&(r=u.getMPID());br(r).add(n,t)},remove:function(n,t){var r,u=i.Identity.getCurrentUser();u&&(r=u.getMPID());br(r).remove(n,t)},clear:function(){var n,t=i.Identity.getCurrentUser();t&&(n=t.getMPID());br(n).clear()}},setCurrencyCode:function(n){if(typeof n!="string"){i.Logger.error("Code must be a string");return}e.resetSessionTimer();i.Store.currencyCode=n},createProduct:function(n,t,i,r,u,f,o,h,c,l){return e.resetSessionTimer(),s.createProduct(n,t,i,r,u,f,o,h,c,l)},createPromotion:function(n,t,i,r){return e.resetSessionTimer(),s.createPromotion(n,t,i,r)},createImpression:function(n,t){return e.resetSessionTimer(),s.createImpression(n,t)},createTransactionAttributes:function(n,t,i,r,u,f){return e.resetSessionTimer(),s.createTransactionAttributes(n,t,i,r,u,f)},logCheckout:function(n,t,i,r){e.resetSessionTimer();l.logCheckoutEvent(n,t,i,r)},logProductAction:function(n,t,i,r){e.resetSessionTimer();l.logProductActionEvent(n,t,i,r)},logPurchase:function(n,t,r,u,f){if(!n||!t){i.Logger.error(gt.ErrorMessages.BadLogPurchase);return}e.resetSessionTimer();l.logPurchaseEvent(n,t,u,f);r===!0&&i.eCommerce.Cart.clear()},logPromotion:function(n,t,i,r){e.resetSessionTimer();l.logPromotionEvent(n,t,i,r)},logImpression:function(n,t,i){e.resetSessionTimer();l.logImpressionEvent(n,t,i)},logRefund:function(n,t,r,u,f){e.resetSessionTimer();l.logRefundEvent(n,t,u,f);r===!0&&i.eCommerce.Cart.clear()},expandCommerceEvent:function(n){return e.resetSessionTimer(),s.expandCommerceEvent(n)}},setSessionAttribute:function(t,f){if(e.resetSessionTimer(),n.canLog()){if(!ni.isValidAttributeValue(f)){i.Logger.error(gt.ErrorMessages.BadAttribute);return}if(!ni.isValidKeyValue(t)){i.Logger.error(gt.ErrorMessages.BadKey);return}if(i.Store.webviewBridgeEnabled)a.sendToNative(u.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:t,value:f}));else{var o=n.findKeyInObject(i.Store.sessionAttributes,t);o&&(t=o);i.Store.sessionAttributes[t]=f;r.update();c.applyToForwarders("setSessionAttribute",[t,f])}}},setOptOut:function(n){e.resetSessionTimer();i.Store.isEnabled=!n;l.logOptOut();r.update();i.Store.activeForwarders.length&&i.Store.activeForwarders.forEach(function(t){if(t.setOptOut){var r=t.setOptOut(n);r&&i.Logger.verbose(r)}})},setIntegrationAttribute:function(t,u){if(typeof t!="number"){i.Logger.error("integrationId must be a number");return}if(u===null)i.Store.integrationAttributes[t]={};else if(n.isObject(u))if(Object.keys(u).length===0)i.Store.integrationAttributes[t]={};else for(var f in u)if(typeof f=="string")if(typeof u[f]=="string")n.isObject(i.Store.integrationAttributes[t])?i.Store.integrationAttributes[t][f]=u[f]:(i.Store.integrationAttributes[t]={},i.Store.integrationAttributes[t][f]=u[f]);else{i.Logger.error("Values for integration attributes must be strings. You entered a "+typeof u[f]);continue}else{i.Logger.error("Keys must be strings, you entered a "+typeof f);continue}else{i.Logger.error("Attrs must be an object with keys and values. You entered a "+typeof u);return}r.update()},getIntegrationAttributes:function(n){return i.Store.integrationAttributes[n]?i.Store.integrationAttributes[n]:{}},addForwarder:function(n){i.preInit.forwarderConstructors.push(n)},configurePixel:function(n){c.configurePixel(n)},_getActiveForwarders:function(){return i.Store.activeForwarders},_getIntegrationDelays:function(){return i.preInit.integrationDelays},_configureFeatures:function(n){for(var t in n)i.Store&&i.preInit.featureFlags&&(i.preInit.featureFlags[t]=n[t])},_setIntegrationDelay:function(n,t){i.preInit.integrationDelays[n]=t}},i.preInit={readyQueue:[],featureFlags:{},integrationDelays:{},forwarderConstructors:[]},window.mParticle&&window.mParticle.config&&window.mParticle.config.hasOwnProperty("rq")&&(i.preInit.readyQueue=window.mParticle.config.rq),window.mParticle=i,i}() ;;



window.mParticle.config.requestConfig = false;;
mParticle.init('8add4d942ce44e4cbac0c330a75f2a9e', window.mParticle.config);;